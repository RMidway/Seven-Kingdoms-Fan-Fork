# Faction tags need to start with 'faction_'

# Supported types:
# liege_titles, liege_titles_w_claimant, character

# The succession law factions have hard coded elements to ensure that the correct heir is shown in Plot and 
# Faction interfaces and that AI faction members vote for laws in accordance with the faction goal.
# The valid tags correspond to the law name: faction_succ_seniority, faction_succ_primogeniture, etc.
# (faction_succ_ultimogeniture is fully supported by the code, but not currently implemented)

###############
# FACTIONS
###############

faction_loyalist = {
    type = character
    exclusive = yes
    cancel_on_leader_death = no 
    
    warning_level = 0 # At this level of faction power we give player an alert. Set to 0 for no alerts.
    
    potential = {
        allow_join_faction_trigger = yes

        OR = {
            is_patrician = yes
            higher_tier_than = BARON
        }
    }
    
    liege = {
        independent = yes
        higher_tier_than = DUKE
        
        OR = {
            is_nomadic = no
            NOT = { has_dlc = "Horse Lords" }
            liege = {
                NOT = { has_blood_oath_with = PREV }
            }
        }
    }
    
    # Requirements to create the faction (checks the title holder/ruler)
    allow = {
        higher_tier_than = DUKE
        prisoner = no
    }
    
    # Requirements to be able to join (ROOT is the character wanting to join)
    # ROOT = JOINER, FROM = TARGET
    allow_join = {
        allow_join_faction_trigger = yes
    }
    
    # Chance they will consider creating the faction.
    chance = {
        factor = 2.0
        
        # Loyalty (Friends, Alliance, Sociopathy)
        
        modifier = { factor = 0.0 is_disloyal_to_liege_trigger = yes }
        modifier = { factor = 0.1 self_serving_trigger = yes }
        modifier = { factor = 1.5 is_friend_with_liege_trigger = yes }
        modifier = { factor = 2.0 is_good_friend_with_liege_trigger = yes }
        
        # Council
        
        modifier = { factor = 1.6 has_council_position_trigger = yes }
        
        # Religion Culture Pull / Aversion
        
        modifier = { factor = 0.8  religion_faction_pull_trigger = yes }
        modifier = { factor = 0.8  culture_faction_pull_trigger = yes }
        
        modifier = { factor = 1.3  religion_faction_aversion_trigger = yes }
        modifier = { factor = 1.3  culture_faction_aversion_trigger = yes }
        
        # Culture
        
        modifier = { factor = 1.2 is_culture_same = yes }
        modifier = { factor = 0.8 is_different_culture_group = yes }
        
        modifier = { factor = 0.5 is_independent_culture_liege_not_same = yes }
        modifier = { factor = 0.5 is_independent_culture_liege_not_same_group = yes }
        
        # Religion
        
        modifier = { factor = 5.0 is_zealous_liege_zealous_same_religion = yes }
        modifier = { factor = 1.3 is_zealous_same_religion = yes }
        modifier = { factor = 1.05 is_cynical_different_religion = yes }
        modifier = { factor = 0.3 is_just_different_religion = yes }
        modifier = { factor = 0.0 is_zealous_different_religion = yes }
        
        # Opinion
        
        # Opinion - Liege's opinion of Vassal (smaller impact due to limited control)
        
        modifier = { factor = 1.20 liege_opinion_vassal_p99_trigger = yes }
        modifier = { factor = 1.15 liege_opinion_vassal_p85_trigger = yes }
        modifier = { factor = 1.125 liege_opinion_vassal_p70_trigger = yes }
        modifier = { factor = 1.1 liege_opinion_vassal_p55_trigger = yes }
        modifier = { factor = 1.075 liege_opinion_vassal_p40_trigger = yes }
        modifier = { factor = 1.05 liege_opinion_vassal_p25_trigger = yes }
        modifier = { factor = 1.025 liege_opinion_vassal_p5_trigger = yes }
        
        modifier = { factor = 0.975 liege_opinion_vassal_n5_trigger = yes }
        modifier = { factor = 0.95 liege_opinion_vassal_n25_trigger = yes }
        modifier = { factor = 0.925 liege_opinion_vassal_n40_trigger = yes }
        modifier = { factor = 0.9 liege_opinion_vassal_n55_trigger = yes }
        modifier = { factor = 0.875 liege_opinion_vassal_n70_trigger = yes }
        modifier = { factor = 0.85 liege_opinion_vassal_n85_trigger = yes }
        modifier = { factor = 0.825 liege_opinion_vassal_n99_trigger = yes }
        
        # Opinion - Vassal's Opinion of Liege
        
        modifier = { factor = 2.0 vassal_opinion_liege_p99 = yes }
        modifier = { factor = 1.8 vassal_opinion_liege_p85 = yes }
        modifier = { factor = 1.6 vassal_opinion_liege_p70 = yes }
        modifier = { factor = 1.4 vassal_opinion_liege_p55 = yes }
        modifier = { factor = 1.3 vassal_opinion_liege_p40 = yes }
        modifier = { factor = 1.2 vassal_opinion_liege_p25 = yes }
        modifier = { factor = 1.05 vassal_opinion_liege_p5 = yes }
        
        modifier = { factor = 0.95 vassal_opinion_liege_n5 = yes }
        modifier = { factor = 0.6 vassal_opinion_liege_n25 = yes }
        modifier = { factor = 0.2 vassal_opinion_liege_n40 = yes }
        modifier = { factor = 0.1 vassal_opinion_liege_n55 = yes }
        modifier = { factor = 0.05 vassal_opinion_liege_n70 = yes }
        modifier = { factor = 0.025 vassal_opinion_liege_n85 = yes }
        modifier = { factor = 0.01 vassal_opinion_liege_n99 = yes }
        
        # Traits
        
        modifier = { factor = 3.0 trait = content }
        modifier = { factor = 1.3 trait = honest }
        modifier = { factor = 0.6 trait = deceitful }
        modifier = { factor = 0.6 character_is_irrational = yes }
        
        # Bastard
        
        modifier = { factor = 0.9 liege_is_bastard_kind = yes }
        modifier = { factor = 0.6 liege_is_bastard_unkind = yes }

        # Heir will always be loyal as long as relations are positive.
        
        modifier = { factor = 5.0 heir_positive_rel_3_trigger = yes }
        modifier = { factor = 2.0 heir_positive_rel_2_trigger = yes }
        modifier = { factor = 1.5 heir_positive_rel_1_trigger = yes }
        
        # If you heir is of a foreign religion or culture, they will be unlikely to be loyal.
        
        modifier = { factor = 0.1 heir_not_culture_trigger = yes }
        modifier = { factor = 0.1 heir_not_religion_trigger = yes }
        
        # If they are not of your culture group or religion, then have fun.
        
        modifier = { factor = 0 heir_not_culture_and_religion_trigger = yes }
    }
    
    # The chance that the AI will join (given the faction exists).
    # AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character. 
    
    membership = {
        factor = 2.0
        
        modifier = {
            factor = 0
            
            in_faction_trigger = yes
        }
        
        # Loyalty (Friends, Alliance, Sociopathy)
        
        modifier = { factor = 0.0 is_disloyal_to_liege_trigger = yes }
        modifier = { factor = 0.1 self_serving_trigger = yes }
        modifier = { factor = 1.5 is_friend_with_liege_trigger = yes }
        modifier = { factor = 2.0 is_good_friend_with_liege_trigger = yes }
        
        # Council
        
        modifier = { factor = 1.6 has_council_position_trigger = yes }
        
        # Religion Culture Pull / Aversion
        
        modifier = { factor = 0.8  religion_faction_pull_trigger = yes }
        modifier = { factor = 0.8  culture_faction_pull_trigger = yes }
        
        modifier = { factor = 1.3  religion_faction_aversion_trigger = yes }
        modifier = { factor = 1.3  culture_faction_aversion_trigger = yes }
        
        # Culture
        
        modifier = { factor = 1.2 is_culture_same = yes }
        modifier = { factor = 0.8 is_different_culture_group = yes }
        
        modifier = { factor = 0.5 is_independent_culture_liege_not_same = yes }
        modifier = { factor = 0.5 is_independent_culture_liege_not_same_group = yes }
        
        # Religion
        
        modifier = { factor = 5.0 is_zealous_liege_zealous_same_religion = yes }
        modifier = { factor = 1.3 is_zealous_same_religion = yes }
        modifier = { factor = 1.05 is_cynical_different_religion = yes }
        modifier = { factor = 0.3 is_just_different_religion = yes }
        modifier = { factor = 0.0 is_zealous_different_religion = yes }
        
        # Opinion
        
        # Opinion - Liege's opinion of Vassal (smaller impact due to limited control)
        
        modifier = { factor = 1.20 liege_opinion_vassal_p99_trigger = yes }
        modifier = { factor = 1.15 liege_opinion_vassal_p85_trigger = yes }
        modifier = { factor = 1.125 liege_opinion_vassal_p70_trigger = yes }
        modifier = { factor = 1.1 liege_opinion_vassal_p55_trigger = yes }
        modifier = { factor = 1.075 liege_opinion_vassal_p40_trigger = yes }
        modifier = { factor = 1.05 liege_opinion_vassal_p25_trigger = yes }
        modifier = { factor = 1.025 liege_opinion_vassal_p5_trigger = yes }
        
        modifier = { factor = 0.975 liege_opinion_vassal_n5_trigger = yes }
        modifier = { factor = 0.95 liege_opinion_vassal_n25_trigger = yes }
        modifier = { factor = 0.925 liege_opinion_vassal_n40_trigger = yes }
        modifier = { factor = 0.9 liege_opinion_vassal_n55_trigger = yes }
        modifier = { factor = 0.875 liege_opinion_vassal_n70_trigger = yes }
        modifier = { factor = 0.85 liege_opinion_vassal_n85_trigger = yes }
        modifier = { factor = 0.825 liege_opinion_vassal_n99_trigger = yes }
        
        # Opinion - Vassal's Opinion of Liege
        
        modifier = { factor = 2.0 vassal_opinion_liege_p99 = yes }
        modifier = { factor = 1.8 vassal_opinion_liege_p85 = yes }
        modifier = { factor = 1.6 vassal_opinion_liege_p70 = yes }
        modifier = { factor = 1.4 vassal_opinion_liege_p55 = yes }
        modifier = { factor = 1.3 vassal_opinion_liege_p40 = yes }
        modifier = { factor = 1.2 vassal_opinion_liege_p25 = yes }
        modifier = { factor = 1.05 vassal_opinion_liege_p5 = yes }
        
        modifier = { factor = 0.95 vassal_opinion_liege_n5 = yes }
        modifier = { factor = 0.6 vassal_opinion_liege_n25 = yes }
        modifier = { factor = 0.2 vassal_opinion_liege_n40 = yes }
        modifier = { factor = 0.1 vassal_opinion_liege_n55 = yes }
        modifier = { factor = 0.05 vassal_opinion_liege_n70 = yes }
        modifier = { factor = 0.025 vassal_opinion_liege_n85 = yes }
        modifier = { factor = 0.01 vassal_opinion_liege_n99 = yes }
        
        # Traits
        
        modifier = { factor = 3.0 trait = content }
        modifier = { factor = 1.1 trait = honest }
        modifier = { factor = 0.6 trait = deceitful }
        modifier = { factor = 0.6 character_is_irrational = yes }
        
        # Bastard
        
        modifier = { factor = 0.9 liege_is_bastard_kind = yes }
        modifier = { factor = 0.6 liege_is_bastard_unkind = yes }

        # Heir will always be loyal as long as relations are positive.
        
        modifier = { factor = 2.25 FROM = { heir_positive_rel_3_trigger = yes } }
        modifier = { factor = 1.75 FROM = { heir_positive_rel_2_trigger = yes } }
        modifier = { factor = 1.25 FROM = { heir_positive_rel_1_trigger = yes } }
        
        # If you heir is of a foreign religion or culture, they will be unlikely to be loyal.
        
        modifier = { factor = 0.8 heir_not_culture_trigger = yes }
        modifier = { factor = 0.5 heir_not_religion_trigger = yes }
        
        # If they are not of your culture group or religion, then have fun.
        
        modifier = { factor = 0 heir_not_culture_and_religion_trigger = yes }
    }
    
    success = {
        always = no
    }
    abort = {
        always = no
    }
    abort_effect = {
    }
    effect = {
    }
}

# Institute Succession by Seniority in Liege Title
faction_succ_seniority = {
    type = liege_titles
    
    warning_level = 0.7 # At this level of faction power we give player an alert. Set to 0 for no alerts.
    
    # Plotter scope
    potential = {
        NOT = {
            in_faction = faction_loyalist
        }
        
        allow_join_faction_trigger = yes
        
        OR = {
            NOT = { has_dlc = "Zeus" }
            is_voter = no
            is_nomadic = yes
            is_tribal = yes
            liege = { 
                OR = {
                    is_council_content = no
                    NOT = { primary_title = { has_law = war_voting_power_1 } }
                    # has_council = no
                }
            }
        }
        liege = {
            is_vice_royalty = no
            is_feudal = yes 
            OR = {
                primary_title = { is_tribal_type_title = no }
                NOT = { culture = ROOT }
                NOT = { religion = ROOT }
            }
            NOT = {
                any_demesne_title = {
                    temporary = yes
                }
            }
        }
        primary_title = { higher_tier_than = BARON }
        
        NOT = { in_faction = faction_succ_primogeniture }
        NOT = { in_faction = faction_succ_feudal_elective }
        NOT = { in_faction = faction_succ_gavelkind }
        
        OR = {
            # Is not affected by a Crown Law title
            NOT = {
                crownlaw_title = {
                    always = yes
                }
            }
            
            # The Crown Law title holder is my liege
            crownlaw_title = {
                holder_scope = {
                    ROOT = {
                        liege = {
                            character = PREVPREV
                        }
                    }
                }
            }
            
            # The Crown Law title allows vassal infighting
            crownlaw_title = {
                NOT = {
                    OR = {
                        has_law = crown_authority_2
                        has_law = crown_authority_3
                        has_law = crown_authority_4
                    }
                }
            }
        }
        
        NOT = { has_character_modifier = faction_succ_seniority_ultimatum_timer }
    }
    
    # Target scope
    allow = {
        is_law_potential = succ_seniority
        is_law_allowed = succ_seniority
        higher_tier_than = DUKE
        NOR = { 
            has_law = succ_seniority
            AND = {
                has_law = succession_voting_power_1
                has_law = succ_feudal_elective
            }
        }
        
        holder_scope = {
            NOT = {
                any_war = {
                    war_title = ROOT
                    using_cb = change_seniority_succession_law
                }
            }
            
            NOT = {
                reverse_has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_leaving_faction
                }
            }
        }
    }
    
    # Faction member scope (ROOT = joiner, FROM = target)
    allow_join = {
        ROOT = {
            is_ruler = yes
            independent = no
            is_landed = yes
            is_adult = yes
            NOT = { trait = incapable }
            prisoner = no
            OR = {
                NOT = { has_dlc = "Zeus"}
                is_voter = no
                is_nomadic = yes
                is_tribal = yes
                liege = { 
                    OR = {
                        is_council_content = no
                        NOT = { primary_title = { has_law = war_voting_power_1 } }
                        #has_council = no
                    }
                }
            }
            
            NOT = { in_faction = faction_succ_primogeniture }
            NOT = { in_faction = faction_succ_feudal_elective }
            NOT = { in_faction = faction_succ_gavelkind }            
        }        
    }
    
    # AI creation weight
    chance = {
        factor = 1
        
        modifier = {
            factor = 0
            FROM = {
                OR = {
                    prisoner = yes
                    has_character_modifier = in_seclusion
                }
            }
        }
        
        modifier = {
            factor = 0
            holder_scope = {
                any_spouse = { character = FROM }
            }
        }
        
        modifier = {
            factor = 0
            current_heir = {
                character = FROM
            }
        }
        
        modifier = {
            factor = 0
            NOT = { would_be_heir_under_law = { who = FROM law = seniority } }
        }
        
        modifier = {
            factor = 0
            FROM = {
                OR = {
                    AND = {
                        NOT = { leads_faction = faction_succ_seniority }
                        opinion = { who = LIEGE value = 50 } 
                    }
                    AND = {
                        leads_faction = faction_succ_seniority
                        opinion = { who = LIEGE value = 75 } 
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            FROM = { preparing_invasion = yes }
        }
        
        modifier = {
            factor = 0
            FROM = { 
                opinion = { who = LIEGE value = 25 } 
                NOT = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }            
            }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                opinion = { who = LIEGE value = 50 } 
                OR = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }                
            }
        }
        
        modifier = {
            factor = 0.2
            FROM = { pacifist = yes }
        }
        
        modifier = {
            factor = 1.5
            NOT = { FROM = { opinion = { who = LIEGE value = 0 } } }
        }
        modifier = {
            factor = 2.0
            NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
        }
        modifier = {
            factor = 4.0
            NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
        }
        modifier = {
            factor = 0
            FROM = { trait = content }
        }
        modifier = {
            factor = 0.01
            FROM = { trait = imbecile }
        }
        modifier = {
            factor = 0.05
            FROM = { trait = inbred }
        }
        modifier = {
            factor = 0.05
            FROM = { trait = craven }
        }
        modifier = {
            factor = 0.1
            FROM = { 
                OR = {
                    trait = slow
                    trait = dull
                }
            }
        }
        modifier = {
            factor = 0.25
            FROM = { trait = kind }
        }
        modifier = {
            factor = 0.25
            FROM = { trait = charitable }
        }
        modifier = {
            factor = 0.25
            FROM = { trait = honest }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = humble }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = just }
        }
        modifier = {
            factor = 1.0
            FROM = { trait = arbitrary }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = envious }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = greedy }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = deceitful }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = ambitious }
        }
    }
    
    # AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
    membership = {
        factor = 1
        
        modifier = {
            factor = 0
            
            in_faction = faction_loyalist
        }
        
        modifier = {
            factor = 0.2
            pacifist = yes
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }            
        
        modifier = {
            factor = 0
            OR = {
                prisoner = yes
                trait = incapable
                is_adult = no
                is_landed = no
                preparing_invasion = yes
            }
        }
        
        modifier = {
            factor = 0
            FROMFROM = {
                current_heir = {
                    character = ROOT
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            OR = {
                in_faction = faction_succ_feudal_elective
                in_faction = faction_succ_primogeniture
                in_faction = faction_succ_gavelkind
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_character_modifier = faction_succ_seniority_ultimatum_timer
        }
        
        modifier = {
            factor = 0
            liege = { 
                primary_title = { is_tribal_type_title = yes }
                culture = ROOT
                religion = ROOT
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_opinion_modifier = {
                who = LIEGE
                modifier = opinion_coerced_into_leaving_faction
            }
        }
        
        modifier = {
            factor = 0
            OR = {
                AND = {
                    NOT = { in_faction = faction_succ_seniority }
                    opinion = { who = LIEGE value = 50 } 
                }
                AND = {
                    in_faction = faction_succ_seniority
                    opinion = { who = LIEGE value = 75 } 
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        # Try to exclude people who should rather support a claimant
        modifier = {
            factor = 0
            FROM = { # Remember: the faction leader is also the person who would inherit under this law
                OR = {
                    NOT = { culture = ROOT }
                    NOT = { religion = ROOT }
                }
                liege = {
                    any_demesne_title = {
                        OR = {
                            is_primary_holder_title = yes
                            higher_tier_than = DUKE
                        }
                        ROOT = {
                            primary_title = {
                                de_jure_liege_or_above = PREVPREV
                            }
                        }
                        any_claimant = {
                            culture = ROOT
                            religion = ROOT
                        }
                    }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            FROMFROM = {
                heir_under_seniority_law = {
                    ROOT = {
                        OR = {
                            AND = {
                                NOT = { in_faction = faction_succ_seniority }
                                opinion_diff = {
                                    first = LIEGE
                                    second = PREV
                                    value = -10 # I don't like the pretender enough
                                    as_if_liege = yes
                                }
                            }
                            AND = {
                                in_faction = faction_succ_seniority
                                opinion_diff = {
                                    first = LIEGE
                                    second = PREV
                                    value = 10
                                    as_if_liege = yes
                                }
                            }
                        }
                    }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 1000
            has_opinion_modifier = {
                who = FROM
                modifier = opinion_coerced_into_joining_faction
            }
        }
        
        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 25 } 
            NOT = {
                trait = deceitful
                trait = ambitious
                trait = envious
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }            
        }        
        
        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 50 } 
            OR = {
                trait = deceitful
                trait = ambitious
                trait = envious
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }            
        }
        
        modifier = {
            factor = 2
            FROMFROM = {
                heir_under_seniority_law = {
                    ROOT = {
                        opinion_diff = {
                            first = PREV
                            second = LIEGE
                            value = 25
                            as_if_liege = yes
                        }
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            trait = content
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.01
            trait = imbecile
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.05
            trait = inbred
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.05
            trait = craven
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            OR = {
                trait = slow
                trait = dull
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.25
            trait = kind
        }
        modifier = {
            factor = 0.25
            trait = charitable
        }
        modifier = {
            factor = 0.25
            trait = honest
        }
        modifier = {
            factor = 0.5
            trait = humble
        }
        modifier = {
            factor = 0.5
            trait = just
        }
        modifier = {
            factor = 1.0
            trait = arbitrary
        }
        modifier = {
            factor = 1.5
            trait = envious
        }
        modifier = {
            factor = 1.5
            trait = greedy
        }
        modifier = {
            factor = 1.5
            trait = deceitful
        }
        modifier = {
            factor = 2.0
            trait = ambitious
        }
    }
    
    success = {
        has_law = succ_seniority
    }
    
    abort = {
        always = no        # Factions will abort if the Potential or Allow triggers are no longer valid
    }
    
    abort_effect = {
    }
    
    effect = {
        FROM = {
            any_faction_backer = {
                faction = faction_succ_seniority
                reverse_opinion = {
                    modifier = opinion_grateful
                    who = FROM
                    years = 5
                }
            }
        }
    }
}

# Institute Succession by Primogeniture
faction_succ_primogeniture = {
    type = liege_titles
    
    warning_level = 0.7 # At this level of faction power we give player an alert. Set to 0 for no alerts.
    
    # Plotter scope
    potential = {
        NOT = {
            in_faction = faction_loyalist
        }
        
        allow_join_faction_trigger = yes
        
        OR = {
            NOT = { has_dlc = "Zeus" }
            is_voter = no
            is_nomadic = yes
            is_tribal = yes
            liege = { 
                OR = {
                    is_council_content = no
                    NOT = { primary_title = { has_law = war_voting_power_1 } }
                    #has_council = no
                }
            }
        }
        liege = { 
            is_vice_royalty = no
            is_feudal = yes 
            OR = {
                primary_title = { is_tribal_type_title = no }
                NOT = { culture = ROOT }
                NOT = { religion = ROOT }
            }
            NOT = {
                any_demesne_title = {
                    temporary = yes
                }
            }    
        }
        primary_title = { higher_tier_than = BARON }
        
        NOT = { in_faction = faction_succ_seniority }
        NOT = { in_faction = faction_succ_feudal_elective }
        NOT = { in_faction = faction_succ_gavelkind }
        
        OR = {
            # Is not affected by a Crown Law title
            NOT = {
                crownlaw_title = {
                    always = yes
                }
            }
            
            # The Crown Law title holder is my liege
            crownlaw_title = {
                holder_scope = {
                    ROOT = {
                        liege = {
                            character = PREVPREV
                        }
                    }
                }
            }
            
            # The Crown Law title allows vassal infighting
            crownlaw_title = {
                NOT = {
                    OR = {
                        has_law = crown_authority_2
                        has_law = crown_authority_3
                        has_law = crown_authority_4
                    }
                }
            }
        }
        
        NOT = { has_character_modifier = faction_succ_primogeniture_ultimatum_timer }
    }
    
    # Target scope
    allow = {
        is_law_potential = succ_primogeniture
        is_law_allowed = succ_primogeniture    
        OR = {
            is_primary_holder_title = yes
            higher_tier_than = DUKE
        }
        NOR = { 
            has_law = succ_primogeniture
            AND = {
                has_law = succession_voting_power_1
                has_law = succ_feudal_elective
            }
        }
        
        holder_scope = {
            NOT = {
                any_war = {
                    war_title = ROOT
                    using_cb = change_primogeniture_succession_law
                }
            }
            
            NOT = {
                reverse_has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_leaving_faction
                }
            }
        }
    }
    
    # Faction member scope (ROOT = joiner, FROM = target)
    allow_join = {
        ROOT = {
            is_ruler = yes
            independent = no
            is_landed = yes
            is_adult = yes
            NOT = { trait = incapable }
            prisoner = no
            OR = {
                NOT = { has_dlc = "Zeus"}
                is_voter = no
                is_nomadic = yes
                is_tribal = yes
                liege = { 
                    OR = {
                        is_council_content = no
                        NOT = { primary_title = { has_law = war_voting_power_1 } }
                        #has_council = no
                    }
                }
            }
            
            NOT = { in_faction = faction_succ_seniority }
            NOT = { in_faction = faction_succ_feudal_elective }
            NOT = { in_faction = faction_succ_gavelkind }    
        }
    }    
    
    # AI creation weight
    chance = {
        factor = 1
        
        modifier = {
            factor = 0.2
            FROM = { pacifist = yes }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                OR = {
                    prisoner = yes
                    has_character_modifier = in_seclusion
                }
            }
        }
        
        modifier = {
            factor = 0
            holder_scope = {
                any_spouse = { character = FROM }
            }
        }
        
        modifier = {
            factor = 0
            current_heir = {
                character = FROM
            }
        }
        
        modifier = {
            factor = 0
            NOT = { would_be_heir_under_law = { who = FROM law = primogeniture } }
        }
        
        modifier = {
            factor = 0
            FROM = { preparing_invasion = yes }
        }
        
        modifier = {
            factor = 0
            FROM = {
                OR = {
                    AND = {
                        NOT = { leads_faction = faction_succ_primogeniture }
                        opinion = { who = LIEGE value = 50 } 
                    }
                    AND = {
                        leads_faction = faction_succ_primogeniture
                        opinion = { who = LIEGE value = 75 } 
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            FROM = { 
                opinion = { who = LIEGE value = 25 } 
                NOT = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }            
            }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                opinion = { who = LIEGE value = 50 } 
                OR = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }                    
            }
        }
        
        modifier = {
            factor = 1.5
            NOT = { FROM = { opinion = { who = LIEGE value = 0 } } }
        }
        modifier = {
            factor = 2.0
            NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
        }
        modifier = {
            factor = 4.0
            NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
        }
        modifier = {
            factor = 0
            FROM = { trait = content }
        }
        modifier = {
            factor = 0.01
            FROM = { trait = imbecile }
        }
        modifier = {
            factor = 0.05
            FROM = { trait = inbred }
        }
        modifier = {
            factor = 0.05
            FROM = { trait = craven }
        }
        modifier = {
            factor = 0.1
            FROM = { 
                OR = {
                    trait = slow
                    trait = dull
                }
            }
        }
        modifier = {
            factor = 0.25
            FROM = { trait = kind }
        }
        modifier = {
            factor = 0.25
            FROM = { trait = charitable }
        }
        modifier = {
            factor = 0.25
            FROM = { trait = honest }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = humble }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = just }
        }
        modifier = {
            factor = 1.0
            FROM = { trait = arbitrary }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = envious }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = greedy }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = deceitful }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = ambitious }
        }
    }
    
    # AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
    membership = {
        factor = 1
        
        modifier = {
            factor = 0
            
            in_faction = faction_loyalist
        }
        
        modifier = {
            factor = 0.2
            pacifist = yes
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }            
        
        modifier = {
            factor = 0
            OR = {
                prisoner = yes
                trait = incapable
                is_adult = no
                is_landed = no
                preparing_invasion = yes
            }
        }
        
        modifier = {
            factor = 0
            FROMFROM = {
                current_heir = {
                    character = ROOT
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            OR = {
                in_faction = faction_succ_feudal_elective
                in_faction = faction_succ_seniority
                in_faction = faction_succ_gavelkind
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_character_modifier = faction_succ_primogeniture_ultimatum_timer
        }
        
        modifier = {
            factor = 0
            liege = { 
                NOT = { year = 1350 }
                primary_title = { is_tribal_type_title = yes }
                culture = ROOT
                religion = ROOT
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_opinion_modifier = {
                who = LIEGE
                modifier = opinion_coerced_into_leaving_faction
            }
        }
        
        modifier = {
            factor = 0
            FROMFROM = {
                heir_under_primogeniture_law = {
                    ROOT = {
                        OR = {
                            AND = {
                                NOT = { in_faction = faction_succ_primogeniture }
                                opinion_diff = {
                                    first = LIEGE
                                    second = PREV
                                    value = -10 # I don't like the pretender enough
                                    as_if_liege = yes
                                }
                            }
                            AND = {
                                in_faction = faction_succ_primogeniture
                                opinion_diff = {
                                    first = LIEGE
                                    second = PREV
                                    value = 10
                                    as_if_liege = yes
                                }
                            }
                        }
                    }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            OR = {
                AND = {
                    NOT = { in_faction = faction_succ_primogeniture }
                    opinion = { who = LIEGE value = 50 } 
                }
                AND = {
                    in_faction = faction_succ_primogeniture
                    opinion = { who = LIEGE value = 75 } 
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        # Try to exclude people who should rather support a claimant
        modifier = {
            factor = 0
            FROM = { # Remember: the faction leader is also the person who would inherit under this law
                OR = {
                    NOT = { culture = ROOT }
                    NOT = { religion = ROOT }
                }
                liege = {
                    any_demesne_title = {
                        OR = {
                            is_primary_holder_title = yes
                            higher_tier_than = DUKE
                        }
                        ROOT = {
                            primary_title = {
                                de_jure_liege_or_above = PREVPREV
                            }
                        }
                        any_claimant = {
                            culture = ROOT
                            religion = ROOT
                        }
                    }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 25 } 
            NOT = {
                trait = deceitful
                trait = ambitious
                trait = envious
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }            
        }        
        
        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 50 } 
            OR = {
                trait = deceitful
                trait = ambitious
                trait = envious
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }            
        }
        
        modifier = {
            factor = 1000
            has_opinion_modifier = {
                who = FROM
                modifier = opinion_coerced_into_joining_faction
            }
        }
        
        modifier = {
            factor = 2
            FROMFROM = {
                heir_under_primogeniture_law = {
                    ROOT = {
                        opinion_diff = {
                            first = PREV
                            second = LIEGE
                            value = 25
                            as_if_liege = yes
                        }
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            trait = content
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.01
            trait = imbecile
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.05
            trait = inbred
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.05
            trait = craven
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            OR = {
                trait = slow
                trait = dull
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.25
            trait = kind
        }
        modifier = {
            factor = 0.25
            trait = charitable
        }
        modifier = {
            factor = 0.25
            trait = honest
        }
        modifier = {
            factor = 0.5
            trait = humble
        }
        modifier = {
            factor = 0.5
            trait = just
        }
        modifier = {
            factor = 1.0
            trait = arbitrary
        }
        modifier = {
            factor = 1.5
            trait = envious
        }
        modifier = {
            factor = 1.5
            trait = greedy
        }
        modifier = {
            factor = 1.5
            trait = deceitful
        }
        modifier = {
            factor = 2.0
            trait = ambitious
        }
    }
    
    success = {
        has_law = succ_primogeniture
    }
    
    abort = {
        always = no        # Factions will abort if the Potential or Allow triggers are no longer valid
    }
    
    abort_effect = {
    }
    
    effect = {
        FROM = {
            any_faction_backer = {
                faction = faction_succ_primogeniture
                reverse_opinion = {
                    modifier = opinion_grateful
                    who = FROM
                    years = 5
                }
            }
        }
    }
}


# Institute Succession by Gavelkind
# Edits:
# Removed the ability for people to bring it in
# unless they are nomadic or tribal.
faction_succ_gavelkind = {
    type = liege_titles
    
    warning_level = 0.7 # At this level of faction power we give player an alert. Set to 0 for no alerts.
    
    # Plotter scope
    potential = {
        NOT = {
            in_faction = faction_loyalist
        }
        
        allow_join_faction_trigger = yes
        
        OR = {
            NOT = { has_dlc = "Zeus" }
            # is_voter = no
            is_nomadic = yes
            is_tribal = yes
            #liege = { 
            #    OR = {
            #        is_council_content = no
            #        NOT = { primary_title = { has_law = war_voting_power_1 } }
            #        #has_council = no
            #    }
            #}
        }
        liege = { 
            is_vice_royalty = no
            is_feudal = yes 
            OR = {
                primary_title = { is_tribal_type_title = no }
                NOT = { culture = ROOT }
                NOT = { religion = ROOT }
            }
            NOT = {
                any_demesne_title = {
                    temporary = yes
                }
            }
        }
        primary_title = { higher_tier_than = BARON }
        
        NOT = { in_faction = faction_succ_seniority }
        NOT = { in_faction = faction_succ_primogeniture }
        NOT = { in_faction = faction_succ_feudal_elective }
        
        OR = {
            # Is not affected by a Crown Law title
            NOT = {
                crownlaw_title = {
                    always = yes
                }
            }
            
            # The Crown Law title holder is my liege
            crownlaw_title = {
                holder_scope = {
                    ROOT = {
                        liege = {
                            character = PREVPREV
                        }
                    }
                }
            }
            
            # The Crown Law title allows vassal infighting
            crownlaw_title = {
                NOT = {
                    OR = {
                        has_law = crown_authority_2
                        has_law = crown_authority_3
                        has_law = crown_authority_4
                    }
                }
            }
        }
        
        NOT = { has_character_modifier = faction_succ_gavelkind_ultimatum_timer }
    }
    
    # Target scope
    allow = {
        is_law_potential = succ_gavelkind
        is_law_allowed = succ_gavelkind
        OR = {
            is_primary_holder_title = yes
            higher_tier_than = DUKE
        }
        NOR = { 
            has_law = succ_gavelkind
            AND = {
                has_law = succession_voting_power_1
                has_law = succ_feudal_elective
            }
        }
        
        holder_scope = {
            NOT = {
                any_war = {
                    war_title = ROOT
                    using_cb = change_gavelkind_succession_law
                }
            }
            
            NOT = {
                reverse_has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_leaving_faction
                }
            }
        }
    }
    
    # Faction member scope (ROOT = joiner, FROM = target)
    allow_join = {
        ROOT = {
            is_ruler = yes
            independent = no
            is_landed = yes
            is_adult = yes
            NOT = { trait = incapable }
            prisoner = no
            OR = {
                NOT = { has_dlc = "Zeus"}
                is_voter = no
                is_nomadic = yes
                is_tribal = yes
                liege = { 
                    OR = {
                        is_council_content = no
                        NOT = { primary_title = { has_law = war_voting_power_1 } }
                        #has_council = no
                    }
                }
            }
            
            NOT = { in_faction = faction_succ_seniority }
            NOT = { in_faction = faction_succ_primogeniture }
            NOT = { in_faction = faction_succ_feudal_elective }
        }
    }
    
    # AI creation weight
    chance = {
        factor = 1
        
        modifier = {
            factor = 0.2
            FROM = { pacifist = yes }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                OR = {
                    prisoner = yes
                    has_character_modifier = in_seclusion
                }
            }
        }
        
        modifier = {
            factor = 0
            holder_scope = {
                any_spouse = { character = FROM }
            }
        }
        
        modifier = {
            factor = 0
            current_heir = {
                character = FROM
            }
        }
        
        modifier = {
            factor = 0
            has_law = succ_feudal_elective
        }
        
        modifier = {
            factor = 0
            # Is not a child of the title holder, and no need to split the demesne
            holder_scope = {
                NOT = {
                    any_demesne_title = {
                        tier = PREVPREV
                        NOT = { title = PREVPREV }
                    }
                }
                FROM = {
                    OR = {
                        NOT = { is_child_of = PREV }
                        trait = bastard
                        AND = {
                            is_female = yes
                            is_pretender = no
                        }
                    }
                }
            }
        }
        
        # Try to exclude people who should rather support a claimant
        modifier = {
            factor = 0
            holder_scope = {
                OR = {
                    NOT = { culture = FROM }
                    NOT = { religion = FROM }
                }
                any_demesne_title = {
                    OR = {
                        is_primary_holder_title = yes
                        higher_tier_than = DUKE
                    }
                    FROM = {
                        primary_title = {
                            de_jure_liege_or_above = PREVPREV
                        }
                    }
                    any_claimant = {
                        culture = FROM
                        religion = FROM
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            FROM = {
                OR = {
                    AND = {
                        NOT = { leads_faction = faction_succ_gavelkind }
                        opinion = { who = LIEGE value = 50 } 
                    }
                    AND = {
                        leads_faction = faction_succ_gavelkind
                        opinion = { who = LIEGE value = 75 } 
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            FROM = { preparing_invasion = yes }
        }
        
        modifier = {
            factor = 0
            FROM = { 
                opinion = { who = LIEGE value = 25 } 
                NOT = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }            
            }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                opinion = { who = LIEGE value = 50 } 
                OR = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }                    
            }
        }
        
        modifier = {
            factor = 1.5
            NOT = { FROM = { opinion = { who = LIEGE value = 0 } } }
        }
        modifier = {
            factor = 2.0
            NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
        }
        modifier = {
            factor = 4.0
            NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
        }
        
        modifier = {
            factor = 4.0
            FROM = { is_pretender = yes }
        }
        
        modifier = {
            factor = 0
            FROM = { trait = content }
        }
        modifier = {
            factor = 0.01
            FROM = { trait = imbecile }
        }
        modifier = {
            factor = 0.05
            FROM = { trait = inbred }
        }
        modifier = {
            factor = 0.05
            FROM = { trait = craven }
        }
        modifier = {
            factor = 0.1
            FROM = { 
                OR = {
                    trait = slow
                    trait = dull
                }
            }
        }
        modifier = {
            factor = 0.25
            FROM = { trait = kind }
        }
        modifier = {
            factor = 0.25
            FROM = { trait = charitable }
        }
        modifier = {
            factor = 0.25
            FROM = { trait = honest }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = humble }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = just }
        }
        modifier = {
            factor = 1.0
            FROM = { trait = arbitrary }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = envious }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = greedy }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = deceitful }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = ambitious }
        }
    }
    
    # AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
    membership = {
        factor = 1
        
        modifier = {
            factor = 0
            
            in_faction = faction_loyalist
        }
        
        modifier = {
            factor = 0.2
            pacifist = yes
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }            
        
        modifier = {
            factor = 0
            OR = {
                prisoner = yes
                trait = incapable
                is_adult = no
                is_landed = no
                preparing_invasion = yes
            }
        }
        
        modifier = {
            factor = 0
            FROMFROM = {
                current_heir = {
                    character = ROOT
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            OR = {
                in_faction = faction_succ_feudal_elective
                in_faction = faction_succ_seniority
                in_faction = faction_succ_primogeniture
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            OR = {
                AND = {
                    NOT = { in_faction = faction_succ_gavelkind }
                    opinion_diff = {
                        first = LIEGE
                        second = FROM
                        value = 10 # I like my liege rather a lot more than the faction leader
                        as_if_liege = yes
                    }
                }
                AND = {
                    in_faction = faction_succ_gavelkind
                    opinion_diff = {
                        first = LIEGE
                        second = FROM
                        value = 25
                        as_if_liege = yes
                    }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_character_modifier = faction_succ_gavelkind_ultimatum_timer
        }
        
        modifier = {
            factor = 0
            liege = { 
                NOT = { year = 1350 }
                primary_title = { is_tribal_type_title = yes }
                culture = ROOT
                religion = ROOT
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            OR = {
                AND = {
                    NOT = { in_faction = faction_succ_gavelkind }
                    opinion = { who = LIEGE value = 50 } 
                }
                AND = {
                    in_faction = faction_succ_gavelkind
                    opinion = { who = LIEGE value = 75 } 
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_opinion_modifier = {
                who = LIEGE
                modifier = opinion_coerced_into_leaving_faction
            }
        }
        
        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 25 } 
            NOT = {
                trait = deceitful
                trait = ambitious
                trait = envious
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }            
        }        
        
        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 50 } 
            OR = {
                trait = deceitful
                trait = ambitious
                trait = envious
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }            
        }
        
        modifier = {
            factor = 1000
            has_opinion_modifier = {
                who = FROM
                modifier = opinion_coerced_into_joining_faction
            }
        }
        
        modifier = {
            factor = 2.0
            opinion_diff = {
                first = FROM
                second = LIEGE
                value = 25
                as_if_liege = yes
            }
        }
        
        modifier = {
            factor = 0
            trait = content
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.01
            trait = imbecile
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.05
            trait = inbred
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.05
            trait = craven
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            OR = {
                trait = slow
                trait = dull
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.25
            trait = kind
        }
        modifier = {
            factor = 0.25
            trait = charitable
        }
        modifier = {
            factor = 0.25
            trait = honest
        }
        modifier = {
            factor = 0.5
            trait = humble
        }
        modifier = {
            factor = 0.5
            trait = just
        }
        modifier = {
            factor = 1.0
            trait = arbitrary
        }
        modifier = {
            factor = 1.5
            trait = envious
        }
        modifier = {
            factor = 1.5
            trait = greedy
        }
        modifier = {
            factor = 1.5
            trait = deceitful
        }
        modifier = {
            factor = 2.0
            trait = ambitious
        }
    }
    
    success = {
        has_law = succ_gavelkind
    }
    
    abort = {
        always = no        # Factions will abort if the Potential or Allow triggers are no longer valid
    }
    
    abort_effect = {
    }
    
    effect = {
        FROM = {
            any_faction_backer = {
                faction = faction_succ_gavelkind
                reverse_opinion = {
                    modifier = opinion_grateful
                    who = FROM
                    years = 5
                }
            }
        }
    }
}

# Institute Succession by Feudal Elective
faction_succ_feudal_elective = {
    type = liege_titles
    
    warning_level = 0.7 # At this level of faction power we give player an alert. Set to 0 for no alerts.
    
    # Plotter scope
    potential = {
        NOT = {
            in_faction = faction_loyalist
        }
        
        allow_join_faction_trigger = yes
        
        OR = {
            NOT = { has_dlc = "Zeus" }
            is_voter = no
            liege = {
                OR = {
                    is_council_content = no
                    NOT = { primary_title = { has_law = war_voting_power_1 } }
                    #has_council = no
                }
            }
            is_nomadic = yes
        }
        liege = { 
            is_vice_royalty = no
            is_feudal = yes 
            OR = {
                primary_title = { is_tribal_type_title = no }
                NOT = { culture = ROOT }
                NOT = { religion = ROOT }
            }
            NOT = {
                any_demesne_title = {
                    temporary = yes
                }
            }            
        }
        primary_title = { higher_tier_than = BARON }
        
        NOT = { in_faction = faction_succ_seniority }
        NOT = { in_faction = faction_succ_primogeniture }
        NOT = { in_faction = faction_succ_gavelkind }
        
        OR = {
            # Is not affected by a Crown Law title
            NOT = {
                crownlaw_title = {
                    always = yes
                }
            }
            
            # The Crown Law title holder is my liege
            crownlaw_title = {
                holder_scope = {
                    ROOT = {
                        liege = {
                            character = PREVPREV
                        }
                    }
                }
            }
            
            # The Crown Law title allows vassal infighting
            crownlaw_title = {
                NOT = {
                    OR = {
                        has_law = crown_authority_2
                        has_law = crown_authority_3
                        has_law = crown_authority_4
                    }
                }
            }
        }
        
        NOT = { has_character_modifier = faction_succ_feudal_elective_ultimatum_timer }
    }
    
    # Target scope
    allow = {
        is_law_potential = succ_feudal_elective
        is_law_allowed = succ_feudal_elective    
        NOR = { 
            has_law = succ_feudal_elective
            AND = {
                has_law = succession_voting_power_1
                has_law = succ_feudal_elective
            }
        }
        
        OR = {
            is_primary_holder_title = yes
            higher_tier_than = DUKE
        }
        
        holder_scope = {
            NOT = {
                any_war = {
                    war_title = ROOT
                    using_cb = change_feudal_elective_succession_law
                }
            }
            
            NOT = {
                reverse_has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_leaving_faction
                }
            }
        }
        
    }
    
    # Faction member scope (ROOT = joiner, FROM = target)
    allow_join = {
        ROOT = {
            is_ruler = yes
            independent = no
            is_landed = yes
            is_adult = yes
            NOT = { trait = incapable }
            prisoner = no
            OR = {
                NOT = { has_dlc = "Zeus"}
                is_voter = no
                is_nomadic = yes
                is_tribal = yes
                liege = {
                    OR = {
                        is_council_content = no
                        NOT = { primary_title = { has_law = war_voting_power_1 } }
                        #has_council = no
                    }
                }
            }
            
            NOT = { in_faction = faction_succ_seniority }
            NOT = { in_faction = faction_succ_primogeniture }
            NOT = { in_faction = faction_succ_gavelkind }
        }
    }        
    
    # AI creation weight
    chance = {
        factor = 1
        
        modifier = {
            factor = 0.2
            FROM = { pacifist = yes }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                OR = {
                    prisoner = yes
                    has_character_modifier = in_seclusion
                }
            }
        }
        
        modifier = {
            factor = 0
            FROM = {
                lower_tier_than = DUKE
            }
        }
        
        modifier = {
            factor = 0
            holder_scope = {
                any_spouse = { character = FROM }
            }
        }
        
        # Not for the current heir
        modifier = {
            factor = 0
            current_heir = {
                character = FROM
            }
        }
        
        # Not for spouse of current heir
        modifier = {
            factor = 0
            current_heir = {
                any_spouse = { character = FROM }
            }
        }
        
        # Not for children of the present holder
        modifier = {
            factor = 0
            holder_scope = {
                FROM = {
                    is_child_of = PREV
                }
            }
        }
        
        # Not for dynasty members if under seniority law
        modifier = {
            factor = 0
            has_law = succ_seniority
            holder_scope = {
                dynasty = FROM
            }
        }
        
        # If next in line under seniority, choose that plot insetead
        modifier = {
            factor = 0
            would_be_heir_under_law = { who = FROM law = seniority }
        }
        
        # Try to exclude people who should rather support a claimant
        modifier = {
            factor = 0
            holder_scope = {
                OR = {
                    NOT = { culture = FROM }
                    NOT = { religion = FROM }
                }
                any_demesne_title = {
                    OR = {
                        is_primary_holder_title = yes
                        higher_tier_than = DUKE
                    }
                    FROM = {
                        primary_title = {
                            de_jure_liege_or_above = PREVPREV
                        }
                    }
                    any_claimant = {
                        culture = FROM
                        religion = FROM
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            FROM = {
                OR = {
                    AND = {
                        NOT = { leads_faction = faction_succ_feudal_elective }
                        opinion = { who = LIEGE value = 50 } 
                    }
                    AND = {
                        leads_faction = faction_succ_feudal_elective
                        opinion = { who = LIEGE value = 75 } 
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            FROM = { preparing_invasion = yes }
        }
        
        modifier = {
            factor = 0
            FROM = { 
                opinion = { who = LIEGE value = 25 } 
                NOT = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }            
            }
        }    
        
        modifier = {
            factor = 0
            FROM = {
                opinion = { who = LIEGE value = 50 } 
                OR = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }                
            }
        }

        modifier = {
            factor = 2
            FROM = {
                liege = {
                    has_council = yes
                }
                is_voter = yes
            }
        }
        
        modifier = {
            factor = 1.5
            NOT = { FROM = { opinion = { who = LIEGE value = 0 } } }
        }
        modifier = {
            factor = 2.0
            NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
        }
        modifier = {
            factor = 4.0
            NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
        }
        
        modifier = {
            factor = 4.0
            FROM = { is_pretender = yes }
        }
        
        modifier = {
            factor = 0
            FROM = { trait = content }
        }
        modifier = {
            factor = 0.01
            FROM = { trait = imbecile }
        }
        modifier = {
            factor = 0.05
            FROM = { trait = inbred }
        }
        modifier = {
            factor = 0.05
            FROM = { trait = craven }
        }
        modifier = {
            factor = 0.1
            FROM = { 
                OR = {
                    trait = slow
                    trait = dull
                }
            }
        }
        modifier = {
            factor = 0.25
            FROM = { trait = kind }
        }
        modifier = {
            factor = 0.25
            FROM = { trait = charitable }
        }
        modifier = {
            factor = 0.25
            FROM = { trait = honest }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = humble }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = just }
        }
        modifier = {
            factor = 1.0
            FROM = { trait = arbitrary }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = envious }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = greedy }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = deceitful }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = ambitious }
        }
        modifier = {
            factor = 1
            calc_true_if = {
                amount = 6
                has_law = law_voting_power_1
                has_law = banish_voting_power_1
                has_law = execution_voting_power_1
                has_law = revoke_title_voting_power_1
                has_law = grant_title_voting_power_1
                has_law = imprison_voting_power_1
                has_law = war_voting_power_1
            }
        }
    }
    
    # AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
    membership = {
        factor = 1
        
        modifier = {
            factor = 0
            
            in_faction = faction_loyalist
        }
        
        modifier = {
            factor = 0.2
            pacifist = yes
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }        
        
        modifier = {
            factor = 0
            OR = {
                prisoner = yes
                trait = incapable
                is_adult = no
                is_landed = no
                preparing_invasion = yes
            }
        }
        
        modifier = {
            factor = 0
            FROMFROM = {
                current_heir = {
                    character = ROOT
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            OR = {
                in_faction = faction_succ_seniority
                in_faction = faction_succ_primogeniture
                in_faction = faction_succ_gavelkind
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            
            OR = {
                AND = {
                    NOT = { in_faction = faction_succ_feudal_elective }
                    opinion_diff = {
                        first = LIEGE
                        second = FROM
                        value = 10 # I like my liege rather a lot more than the faction leader
                        as_if_liege = yes
                    }
                }
                AND = {
                    in_faction = faction_succ_feudal_elective
                    opinion_diff = {
                        first = LIEGE
                        second = FROM
                        value = 25
                        as_if_liege = yes
                    }
                }
            }
            
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            OR = {
                AND = {
                    NOT = { in_faction = faction_succ_feudal_elective }
                    opinion = { who = LIEGE value = 50 } 
                }
                AND = {
                    in_faction = faction_succ_feudal_elective
                    opinion = { who = LIEGE value = 75 } 
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            liege = { 
                primary_title = { is_tribal_type_title = yes }
                culture = ROOT
                religion = ROOT
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_opinion_modifier = {
                who = LIEGE
                modifier = opinion_coerced_into_leaving_faction
            }
        }
        
        modifier = {
            factor = 0
            has_character_modifier = faction_succ_feudal_elective_ultimatum_timer
        }
        
        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 25 } 
            NOT = {
                trait = deceitful
                trait = ambitious
                trait = envious
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }            
        }        
        
        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 50 } 
            OR = {
                trait = deceitful
                trait = ambitious
                trait = envious
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }            
        }

        modifier = {
            factor = 2
            liege = {
                has_council = yes
            }
            is_voter = yes
        }
        
        modifier = {
            factor = 1000
            has_opinion_modifier = {
                who = FROM
                modifier = opinion_coerced_into_joining_faction
            }
        }
        
        modifier = {
            factor = 2.0
            opinion_diff = {
                first = FROM
                second = LIEGE
                value = 25
                as_if_liege = yes
            }
        }
        
        modifier = {
            factor = 0
            trait = content
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.01
            trait = imbecile
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.05
            trait = inbred
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.05
            trait = craven
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            OR = {
                trait = slow
                trait = dull
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.25
            trait = kind
        }
        modifier = {
            factor = 0.25
            trait = charitable
        }
        modifier = {
            factor = 0.25
            trait = honest
        }
        modifier = {
            factor = 0.5
            trait = humble
        }
        modifier = {
            factor = 0.5
            trait = just
        }
        modifier = {
            factor = 1.0
            trait = arbitrary
        }
        modifier = {
            factor = 1.5
            trait = envious
        }
        modifier = {
            factor = 1.5
            trait = greedy
        }
        modifier = {
            factor = 1.5
            trait = deceitful
        }
        modifier = {
            factor = 2.0
            trait = ambitious
        }
        modifier = {
            factor = 0.5
            calc_true_if = {
                amount = 2
                has_law = law_voting_power_1
                has_law = banish_voting_power_1
                has_law = execution_voting_power_1
                has_law = revoke_title_voting_power_1
                has_law = grant_title_voting_power_1
                has_law = imprison_voting_power_1
                has_law = war_voting_power_1
            }
        }
        modifier = {
            factor = 0.5
            calc_true_if = {
                amount = 4
                has_law = law_voting_power_1
                has_law = banish_voting_power_1
                has_law = execution_voting_power_1
                has_law = revoke_title_voting_power_1
                has_law = grant_title_voting_power_1
                has_law = imprison_voting_power_1
                has_law = war_voting_power_1
            }
        }
        modifier = {
            factor = 0.5
            calc_true_if = {
                amount = 6
                has_law = law_voting_power_1
                has_law = banish_voting_power_1
                has_law = execution_voting_power_1
                has_law = revoke_title_voting_power_1
                has_law = grant_title_voting_power_1
                has_law = imprison_voting_power_1
                has_law = war_voting_power_1
            }
        }
    }
    
    success = {
        has_law = succ_feudal_elective
    }
    
    abort = {
        always = no        # Factions will abort if the Potential or Allow triggers are no longer valid
    }
    
    abort_effect = {
    }
    
    effect = {
        FROM = {
            any_faction_backer = {
                faction = faction_succ_feudal_elective
                reverse_opinion = {
                    modifier = opinion_grateful
                    who = FROM
                    years = 5
                }
            }
        }
    }
}

# Lower Crown Authority
faction_lower_crown_authority = {
    type = liege_titles
    
    warning_level = 0.7 # At this level of faction power we give player an alert. Set to 0 for no alerts.
    
    # Plotter scope
    potential = {
        NOT = {
            in_faction = faction_loyalist
        }
        
        NOT = { has_dlc = "Zeus" }
        
        allow_join_faction_trigger = yes
        
        liege = { 
            is_feudal = yes 
            OR = {
                primary_title = { is_tribal_type_title = no }
                NOT = { culture = ROOT }
                NOT = { religion = ROOT }
            }
            NOT = {
                any_demesne_title = {
                    temporary = yes
                }
            }            
        }
        primary_title = { higher_tier_than = BARON }
        
        NOT = { has_character_modifier = faction_lower_CA_ultimatum_timer }
    }
    
    # Target scope
    allow = {
        higher_tier_than = DUKE
    
        holder_scope = {
            independent = yes
        }
        
        OR = {
            is_primary_holder_title = yes
            is_titular = no
        }

        NOT = { has_law = crown_authority_0 }
        
        holder_scope = {
            NOT = {
                any_war = {
                    war_title = ROOT
                    using_cb = lower_crown_authority_law
                }
            }
            
            NOT = {
                reverse_has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_leaving_faction
                }
            }
        }
    }
    
    # Faction member scope (ROOT = joiner, FROM = target)
    allow_join = {
        ROOT = {
            NOT = { has_dlc = "Zeus"}
            is_ruler = yes
            independent = no
            is_landed = yes
            is_adult = yes
            NOT = { trait = incapable }
            prisoner = no
        }
    }        
    
    # AI creation weight
    chance = {
        factor = 1
        
        modifier = {
            factor = 0.2
            FROM = { pacifist = yes }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                OR = {
                    prisoner = yes
                    has_character_modifier = in_seclusion
                }
            }
        }
        
        modifier = {
            factor = 0
            holder_scope = {
                any_spouse = { character = FROM }
            }
        }
        
        modifier = {
            factor = 0
            current_heir = {
                character = FROM
            }
        }
        
        modifier = {
            factor = 0
            NOT = { FROM = { crownlaw_title = { title = ROOT } } }
        }
        
        modifier = {
            factor = 0
            holder_scope = {
                FROM = {
                    has_opinion_modifier = { who = PREV modifier = opinion_lowered_crown_authority }
                }
            }
        }
        
        # Try to exclude people who should rather support a claimant
        modifier = {
            factor = 0
            holder_scope = {
                OR = {
                    NOT = { culture = FROM }
                    NOT = { religion = FROM }
                }
                any_demesne_title = {
                    OR = {
                        is_primary_holder_title = yes
                        higher_tier_than = DUKE
                    }
                    FROM = {
                        primary_title = {
                            de_jure_liege_or_above = PREVPREV
                        }
                    }
                    any_claimant = {
                        culture = FROM
                        religion = FROM
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            FROM = { preparing_invasion = yes }
        }
        
        modifier = {
            factor = 0
            FROM = { 
                opinion = { who = LIEGE value = 25 } 
                NOT = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }            
            }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                opinion = { who = LIEGE value = 50 } 
                OR = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }                
            }
        }
        
        modifier = {
            factor = 0.1
            has_law = crown_authority_1
        }
        modifier = {
            factor = 1.5
            has_law = crown_authority_3
        }
        modifier = {
            factor = 2.25
            has_law = crown_authority_4
        }
        
        modifier = {
            factor = 1.5
            NOT = { FROM = { opinion = { who = LIEGE value = -10 } } }
        }
        modifier = {
            factor = 2.0
            NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
        }
        modifier = {
            factor = 4.0
            NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
        }
        
        modifier = {
            factor = 0.01
            FROM = { trait = content }
        }
        modifier = {
            factor = 0.01
            FROM = { trait = imbecile }
        }
        modifier = {
            factor = 0.1
            FROM = { trait = inbred }
        }
        modifier = {
            factor = 0.1
            FROM = { trait = craven }
        }
        modifier = {
            factor = 0.2
            FROM = { 
                OR = {
                    trait = slow
                    trait = dull
                }
            }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = kind }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = charitable }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = honest }
        }
        modifier = {
            factor = 0.75
            FROM = { trait = humble }
        }
        modifier = {
            factor = 0.75
            FROM = { trait = just }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = proud }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = brave }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = arbitrary }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = envious }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = greedy }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = impaler }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = deceitful }
        }
        modifier = {
            factor = 4.0
            FROM = { trait = ambitious }
        }
    }
    
    # AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
    membership = {
        factor = 1
        
        modifier = {
            factor = 0
            
            in_faction = faction_loyalist
        }
        
        modifier = {
            factor = 0.2
            pacifist = yes
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }            
        
        modifier = {
            factor = 0
            OR = {
                prisoner = yes
                trait = incapable
                is_adult = no
                is_landed = no
                preparing_invasion = yes
            }
        }
        
        modifier = {
            factor = 0
            FROMFROM = {
                current_heir = {
                    character = ROOT
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            NOT = { crownlaw_title = { title = FROMFROM } }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_character_modifier = faction_lower_CA_ultimatum_timer
        }
        
        modifier = {
            factor = 0
            NOT = { opinion = { who = FROM value = -40 } }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            liege = { 
                NOT = { year = 1350 }
                primary_title = { is_tribal_type_title = yes }
                culture = ROOT
                religion = ROOT
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_opinion_modifier = {
                who = LIEGE
                modifier = opinion_coerced_into_leaving_faction
            }
        }
        
        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 25 }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 1000
            has_opinion_modifier = {
                who = FROM
                modifier = opinion_coerced_into_joining_faction
            }
        }
        
        modifier = {
            factor = 1.5
            NOT = { opinion = { who = LIEGE value = -10 } }
        }
        modifier = {
            factor = 2.0
            NOT = { opinion = { who = LIEGE value = -50 } }
        }
        modifier = {
            factor = 4.0
            NOT = { opinion = { who = LIEGE value = -75 } }
        }
        
        modifier = {
            factor = 0.1
            FROMFROM = {
                has_law = crown_authority_1
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 1.5
            FROMFROM = {
                has_law = crown_authority_3
            }
        }
        modifier = {
            factor = 2.25
            FROMFROM = {
                has_law = crown_authority_4
            }
        }
        
        modifier = {
            factor = 0.01
            trait = content
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.01
            trait = imbecile
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            trait = inbred
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            trait = craven
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.2
            OR = {
                trait = slow
                trait = dull
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.5
            trait = kind
        }
        modifier = {
            factor = 0.5
            trait = charitable
        }
        modifier = {
            factor = 0.5
            trait = honest
        }
        modifier = {
            factor = 0.75
            trait = humble
        }
        modifier = {
            factor = 0.75
            trait = just
        }
        modifier = {
            factor = 1.5
            trait = proud
        }
        modifier = {
            factor = 1.5
            trait = brave
        }
        modifier = {
            factor = 1.5
            trait = arbitrary
        }
        modifier = {
            factor = 2.0
            trait = envious
        }
        modifier = {
            factor = 2.0
            trait = greedy
        }
        modifier = {
            factor = 2.0
            trait = impaler
        }
        modifier = {
            factor = 2.0
            trait = deceitful
        }
        modifier = {
            factor = 4.0
            trait = ambitious
        }
    }
    
    success = {
        holder_scope = {
            FROM = {
                has_opinion_modifier = { who = PREV modifier = opinion_lowered_crown_authority }
            }
        }
    }
    
    abort = {
        always = no
    }
    
    abort_effect = {
    }
    
    effect = {
        FROM = {
            any_faction_backer = {
                faction = faction_lower_crown_authority
                reverse_opinion = {
                    modifier = opinion_grateful
                    who = FROM
                    years = 5
                }
            }
        }
    }
}

# Lower Tribal Organization
faction_lower_tribal_organization = {
    type = liege_titles
    
    warning_level = 0.7 # At this level of faction power we give player an alert. Set to 0 for no alerts.
    
    # Plotter scope
    potential = {
        NOT = {
            in_faction = faction_loyalist
        }
        
        allow_join_faction_trigger = yes
        
        OR = {
            is_tribal = yes
            AND = {
                has_dlc = "Zeus"
                OR = {
                    is_voter = no
                    is_nomadic = yes
                    liege = { 
                        OR = {
                            is_council_content = no
                            NOT = { primary_title = { has_law = war_voting_power_1 } }
                            #has_council = no
                        }
                    }
                }
            }
        }
        liege = { 
            is_tribal = yes 
            NOT = {
                any_demesne_title = {
                    temporary = yes
                }
            }            
        }
        primary_title = { higher_tier_than = BARON }
        
        NOT = { has_character_modifier = faction_lower_TO_ultimatum_timer }
    }
    
    # Target scope
    allow = {
        higher_tier_than = COUNT
    
        holder_scope = {
            independent = yes
        }
        
        is_primary_holder_title = yes

        NOT = { has_law = tribal_organization_0 }
        
        holder_scope = {
            NOT = {
                any_war = {
                    war_title = ROOT
                    using_cb = lower_tribal_organization_law
                }
            }
            
            NOT = {
                reverse_has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_leaving_faction
                }
            }
        }
    }
    
    # Faction member scope (ROOT = joiner, FROM = target)
    allow_join = {
        ROOT = {
            is_ruler = yes
            independent = no
            is_landed = yes
            is_adult = yes
            NOT = { trait = incapable }
            prisoner = no
            OR = {
                is_tribal = yes
                AND = {
                    has_dlc = "Zeus"
                    OR = {
                        is_voter = no
                        is_nomadic = yes
                        liege = { 
                            OR = {
                                is_council_content = no
                                NOT = { primary_title = { has_law = war_voting_power_1 } }
                                #has_council = no
                            }
                        }
                    }
                }
            }
        }
    }        
    
    # AI creation weight
    chance = {
        factor = 1
        
        modifier = {
            factor = 0
            FROM = { dislike_tribal_organization = no }
        }
        
        modifier = {
            factor = 0.2
            FROM = { pacifist = yes }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                OR = {
                    prisoner = yes
                    has_character_modifier = in_seclusion
                }
            }
        }
        
        modifier = {
            factor = 0
            holder_scope = {
                any_spouse = { character = FROM }
            }
        }
        
        modifier = {
            factor = 0
            current_heir = {
                character = FROM
            }
        }
        
        modifier = {
            factor = 0
            holder_scope = {
                FROM = {
                    has_opinion_modifier = { who = PREV modifier = opinion_lowered_tribal_organization }
                }
            }
        }
        
        # Try to exclude people who should rather support a claimant
        modifier = {
            factor = 0
            holder_scope = {
                OR = {
                    NOT = { culture = FROM }
                    NOT = { religion = FROM }
                }
                any_demesne_title = {
                    OR = {
                        is_primary_holder_title = yes
                        higher_tier_than = COUNT
                    }
                    FROM = {
                        primary_title = {
                            de_jure_liege_or_above = PREVPREV
                        }
                    }
                    any_claimant = {
                        culture = FROM
                        religion = FROM
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            FROM = { preparing_invasion = yes }
        }
        
        modifier = {
            factor = 0
            FROM = { 
                opinion = { who = LIEGE value = 25 } 
                NOT = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }            
            }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                opinion = { who = LIEGE value = 50 } 
                OR = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }                
            }
        }
        
        modifier = {
            factor = 0.1
            has_law = tribal_organization_1
        }
        modifier = {
            factor = 1.5
            has_law = tribal_organization_3
        }
        modifier = {
            factor = 2.25
            has_law = tribal_organization_4
        }
        
        modifier = {
            factor = 1.5
            NOT = { FROM = { opinion = { who = LIEGE value = -10 } } }
        }
        modifier = {
            factor = 2.0
            NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
        }
        modifier = {
            factor = 4.0
            NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
        }
        
        modifier = {
            factor = 0.01
            FROM = { trait = content }
        }
        modifier = {
            factor = 0.01
            FROM = { trait = imbecile }
        }
        modifier = {
            factor = 0.1
            FROM = { trait = inbred }
        }
        modifier = {
            factor = 0.1
            FROM = { trait = craven }
        }
        modifier = {
            factor = 0.2
            FROM = { 
                OR = {
                    trait = slow
                    trait = dull
                }
            }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = kind }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = charitable }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = honest }
        }
        modifier = {
            factor = 0.75
            FROM = { trait = humble }
        }
        modifier = {
            factor = 0.75
            FROM = { trait = just }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = proud }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = brave }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = arbitrary }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = envious }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = greedy }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = impaler }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = deceitful }
        }
        modifier = {
            factor = 4.0
            FROM = { trait = ambitious }
        }
    }
    
    # AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
    membership = {
        factor = 1
        
        modifier = {
            factor = 0
            
            in_faction = faction_loyalist
        }
        
        modifier = {
            factor = 0
            dislike_tribal_organization = no
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0.2
            pacifist = yes
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }            
        
        modifier = {
            factor = 0
            OR = {
                prisoner = yes
                trait = incapable
                is_adult = no
                is_landed = no
                preparing_invasion = yes
            }
        }
        
        modifier = {
            factor = 0
            FROMFROM = {
                current_heir = {
                    character = ROOT
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_character_modifier = faction_lower_TO_ultimatum_timer
        }
        
        modifier = {
            factor = 0
            NOT = { opinion = { who = FROM value = -40 } }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_opinion_modifier = {
                who = LIEGE
                modifier = opinion_coerced_into_leaving_faction
            }
        }
        
        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 25 }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 1000
            has_opinion_modifier = {
                who = FROM
                modifier = opinion_coerced_into_joining_faction
            }
        }
        
        modifier = {
            factor = 1.5
            NOT = { opinion = { who = LIEGE value = -10 } }
        }
        modifier = {
            factor = 2.0
            NOT = { opinion = { who = LIEGE value = -50 } }
        }
        modifier = {
            factor = 4.0
            NOT = { opinion = { who = LIEGE value = -75 } }
        }
        
        modifier = {
            factor = 0.1
            FROMFROM = {
                has_law = tribal_organization_1
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 1.5
            FROMFROM = {
                has_law = tribal_organization_3
            }
        }
        modifier = {
            factor = 2.25
            FROMFROM = {
                has_law = tribal_organization_4
            }
        }
        
        modifier = {
            factor = 0.01
            trait = content
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.01
            trait = imbecile
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            trait = inbred
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            trait = craven
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.2
            OR = {
                trait = slow
                trait = dull
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.5
            trait = kind
        }
        modifier = {
            factor = 0.5
            trait = charitable
        }
        modifier = {
            factor = 0.5
            trait = honest
        }
        modifier = {
            factor = 0.75
            trait = humble
        }
        modifier = {
            factor = 0.75
            trait = just
        }
        modifier = {
            factor = 1.5
            trait = proud
        }
        modifier = {
            factor = 1.5
            trait = brave
        }
        modifier = {
            factor = 1.5
            trait = arbitrary
        }
        modifier = {
            factor = 2.0
            trait = envious
        }
        modifier = {
            factor = 2.0
            trait = greedy
        }
        modifier = {
            factor = 2.0
            trait = impaler
        }
        modifier = {
            factor = 2.0
            trait = deceitful
        }
        modifier = {
            factor = 4.0
            trait = ambitious
        }
    }
    
    success = {
        holder_scope = {
            FROM = {
                has_opinion_modifier = { who = PREV modifier = opinion_lowered_tribal_organization }
            }
        }
    }
    
    abort = {
        always = no
    }
    
    abort_effect = {
    }
    
    effect = {
        FROM = {
            any_faction_backer = {
                faction = faction_lower_tribal_organization
                reverse_opinion = {
                    modifier = opinion_grateful
                    who = FROM
                    years = 5
                }
            }
        }
    }
}

# Independence
faction_independence = {
    type = character
    
    warning_level = 0.7 # At this level of faction power we give player an alert. Set to 0 for no alerts.
    
    # Plotter scope
    potential = {
        NOT = {
            in_faction = faction_loyalist
        }
        
        allow_join_faction_trigger = yes
        
        OR = {
            NOT = { has_dlc = "Zeus" }
            is_voter = no
            is_nomadic = yes
            is_tribal = yes
            liege = { 
                OR = {
                    is_council_content = no
                    NOT = { primary_title = { has_law = war_voting_power_1 } }
                    # has_council = no
                }
            }
        }
        
        OR = {
            ai = yes
            is_feudal = yes
            is_tribal = yes
            is_nomadic = yes
            higher_tier_than = BARON
        }
        
        liege = {
            independent = yes
            NOT = {
                any_war = {
                    using_cb = cb_faction_independence
                }
            }
            
            OR = {
                primary_title = { is_tribal = no }
                NOT = { culture = ROOT }
                NOT = { religion = ROOT }
            }
            
            # Not allowed to start factions like this if our capital borders the liege's capital
            NOT = {
                capital_scope = {
                    any_neighbor_province = {
                        ROOT = {
                            capital_scope = {
                                province = PREVPREV
                            }
                        }
                    }
                }
            }
            
            NOT = {
                any_demesne_title = {
                    temporary = yes
                }
            }            
        }
        
        OR = {
            is_nomadic = no
            NOT = { has_dlc = "Horse Lords" }
            liege = {
                NOT = { has_blood_oath_with = PREV }
            }
        }
        
        # No independence factions in merchant republics
        NOT = {
            AND = {
                is_merchant_republic = yes
                liege = {
                    is_merchant_republic = yes
                }
            }
        }
        
        NOT = { has_character_modifier = faction_independence_ultimatum_timer }
    }
    
    # Target scope
    allow = {
        prisoner = no
        
        NOR = {
            has_opinion_modifier = {
                who = LIEGE
                modifier = opinion_coerced_into_leaving_faction
            }
            AND = {
                is_nomadic = yes
                clan_opinion = { who = LIEGE value = 0 }
            }
        }
    }
    
    # Faction member scope (ROOT = joiner, FROM = target)
    allow_join = {
        ROOT = {
            is_ruler = yes
            independent = no
            is_landed = yes
            is_adult = yes
            prisoner = no
            mercenary = no
            
            OR = {
                NOT = { has_dlc = "Zeus"}
                is_voter = no
                is_nomadic = yes
                is_tribal = yes
                liege = { 
                    OR = {
                        is_council_content = no
                        NOT = { primary_title = { has_law = war_voting_power_1 } }
                        #has_council = no
                    }
                }
            }
            OR = {
                is_nomadic = no
                NOT = {
                    clan_opinion = { who = LIEGE value = 0 }
                }
            }
            
            # No independence factions in merchant republics
            NOT = {
                AND = {
                    is_merchant_republic = yes
                    liege = {
                        is_merchant_republic = yes
                    }
                }
            }
            
            # Can't join factions when in blood oath with liege
            OR = {
                is_nomadic = no
                NOT = { has_dlc = "Horse Lords" }
                liege = {
                    NOT = { has_blood_oath_with = PREV }
                }
            }
        }
    }
    
    # AI creation weight
    chance = {
        factor = 2
		
		modifier = {
            factor = 0.0
            FROM = { religion_group = eastern_group }
        }
		modifier = {
            factor = 0.05
            FROM = { government = vale_government }
        }
		modifier = {
            factor = 0.0
            FROM = { government = muslim_government }
        }
        
        modifier = {
            factor = 0.2
            FROM = { pacifist = yes }
        }
        
        modifier = {
            factor = 0
            FROM = {
                has_character_modifier = in_seclusion
            }
        }
        
        modifier = {
            factor = 0
            war = yes
        }
        
        modifier = {
            factor = 0
            is_patrician = yes
            is_merchant_republic = no
        }
        
        modifier = {
            factor = 0
            liege = {
                current_heir = {
                    character = ROOT
                }
            }
        }
        
        # Try to exclude people who should rather support a claimant
        modifier = {
            factor = 0
            lower_tier_than = KING
            liege = {
                OR = {
                    NOT = { culture = ROOT }
                    NOT = { religion = ROOT }
                }
                any_demesne_title = {
                    OR = {
                        is_primary_holder_title = yes
                        higher_tier_than = DUKE
                    }
                    ROOT = {
                        primary_title = {
                            de_jure_liege_or_above = PREVPREV
                        }
                    }
                    any_claimant = {
                        culture = ROOT
                        religion = ROOT
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            OR = {
                AND = {
                    NOT = { leads_faction = faction_independence }
                    opinion = { who = LIEGE value = 60 }
                }
                AND = {
                    leads_faction = faction_independence
                    opinion = { who = LIEGE value = 80 } 
                }
            }
        }
        
        modifier = {
            factor = 0
            preparing_invasion = yes
        }
        
        # Loyalty (Friends, Alliance, Sociopathy)
        
        modifier = { factor = 2.0 is_disloyal_to_liege_trigger = yes }
        modifier = { factor = 1.5 self_serving_trigger = yes }
        modifier = { factor = 0.1 is_friend_with_liege_trigger = yes }
        modifier = { factor = 0.0 is_good_friend_with_liege_trigger = yes }
        
        # Council
        
        modifier = { factor = 0.4 has_council_position_trigger = yes }
        
        # Religion Culture Pull / Aversion - some rel/cul are pulled to joining, others adverse to joining
        
        modifier = { factor = 1.2  religion_faction_pull_trigger = yes }
        modifier = { factor = 1.2  culture_faction_pull_trigger = yes }
        
        modifier = { factor = 0.7  religion_faction_aversion_trigger = yes }
        modifier = { factor = 0.7  culture_faction_aversion_trigger = yes }
        
        # Culture
        
        modifier = { factor = 0.8 is_culture_same = yes }
        modifier = { factor = 1.2 is_different_culture_group = yes }
        
        modifier = { factor = 2.0 is_independent_culture_liege_not_same = yes }
        modifier = { factor = 2.0 is_independent_culture_liege_not_same_group = yes }
        
        # Religion
        
        modifier = { factor = 0.0 is_zealous_liege_zealous_same_religion = yes }
        modifier = { factor = 0.7 is_zealous_same_religion = yes }
        modifier = { factor = 1.2 is_cynical_different_religion = yes }
        modifier = { factor = 2.0 is_just_different_religion = yes }
        modifier = { factor = 3.0 is_zealous_different_religion = yes }
        
        # Opinion - Liege's opinion of Vassal (smaller impact due to limited control)
        
        modifier = { factor = 0.825 liege_opinion_vassal_p99_trigger = yes }
        modifier = { factor = 0.85 liege_opinion_vassal_p85_trigger = yes }
        modifier = { factor = 0.875 liege_opinion_vassal_p70_trigger = yes }
        modifier = { factor = 0.9 liege_opinion_vassal_p55_trigger = yes }
        modifier = { factor = 0.925 liege_opinion_vassal_p40_trigger = yes }
        modifier = { factor = 0.95 liege_opinion_vassal_p25_trigger = yes }
        modifier = { factor = 0.975 liege_opinion_vassal_p5_trigger = yes }
        
        modifier = { factor = 1.025 liege_opinion_vassal_n5_trigger = yes }
        modifier = { factor = 1.05 liege_opinion_vassal_n25_trigger = yes }
        modifier = { factor = 1.075 liege_opinion_vassal_n40_trigger = yes }
        modifier = { factor = 1.1 liege_opinion_vassal_n55_trigger = yes }
        modifier = { factor = 1.125 liege_opinion_vassal_n70_trigger = yes }
        modifier = { factor = 1.15 liege_opinion_vassal_n85_trigger = yes }
        modifier = { factor = 1.20 liege_opinion_vassal_n99_trigger = yes }
        
        # Opinion - Vassal's Opinion of Liege
        
        modifier = { factor = 0.01 vassal_opinion_liege_p99 = yes }
        modifier = { factor = 0.025 vassal_opinion_liege_p85 = yes }
        modifier = { factor = 0.05 vassal_opinion_liege_p70 = yes }
        modifier = { factor = 0.1 vassal_opinion_liege_p55 = yes }
        modifier = { factor = 0.2 vassal_opinion_liege_p40 = yes }
        modifier = { factor = 0.6 vassal_opinion_liege_p25 = yes }
        modifier = { factor = 0.95 vassal_opinion_liege_p5 = yes }
        
        modifier = { factor = 1.05 vassal_opinion_liege_n5 = yes }
        modifier = { factor = 1.2 vassal_opinion_liege_n25 = yes }
        modifier = { factor = 1.3 vassal_opinion_liege_n40 = yes }
        modifier = { factor = 1.4 vassal_opinion_liege_n55 = yes }
        modifier = { factor = 1.6 vassal_opinion_liege_n70 = yes }
        modifier = { factor = 1.8 vassal_opinion_liege_n85 = yes }
        modifier = { factor = 2.0 vassal_opinion_liege_n99 = yes }
        
        # Distance
        
        modifier = { factor = 1.1 liege_is_600_distance = yes }
        modifier = { factor = 1.3 liege_is_800_distance = yes }
        modifier = { factor = 1.5 liege_is_1200_distance = yes }
        modifier = { factor = 2.0 liege_is_1500_distance = yes }
        
        # Traits
        
        modifier = { factor = 0.1 is_dumb_trigger = yes }
        modifier = { factor = 0.3 has_benevolent_trait_trigger = yes }
        modifier = { factor = 0.5 is_trustworthy_trigger = yes }
        # modifier = { factor = 0.9 is_smart_trigger = yes }
        modifier = { factor = 1.5 character_is_irrational = yes }
        
        
        modifier = { factor = 0.025 trait = content }
        modifier = { factor = 0.025 trait = craven }
        modifier = { factor = 0.1 trait = inbred }
        modifier = { factor = 1.25 trait = envious }
        modifier = { factor = 1.25 trait = brave }
        modifier = { factor = 1.5 trait = proud }
        modifier = { factor = 1.5 trait = arbitrary }
        modifier = { factor = 1.5 trait = greedy }
        modifier = { factor = 2.0 trait = deceitful }
        
        # Bastard
        
        modifier = { factor = 1.1 liege_is_bastard_kind = yes }
        modifier = { factor = 1.6 liege_is_bastard_unkind = yes }
        
        modifier = {
            factor = 1.5
            primary_title = {
                is_vice_royalty = yes
            }
        }
    }
    
    # AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
    membership = {
        factor = 2
        
        modifier = {
            factor = 0
            
            in_faction = faction_loyalist
        }
		modifier = {
            factor = 0.05
            FROM = { government = vale_government }
        }
		modifier = {
            factor = 0.0
            FROM = { religion_group = eastern_group }
        }
		
		modifier = {
            factor = 0.0
            FROM = { government = muslim_government }
        }
        
        modifier = {
            factor = 0.2
            pacifist = yes
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }        
        
        modifier = {
            factor = 0
            OR = {
                prisoner = yes
                trait = incapable
                is_adult = no
                is_landed = no
                preparing_invasion = yes
            }
        }
        
        modifier = {
            factor = 0
            is_patrician = yes
            is_merchant_republic = no
        }
        
        modifier = {
            factor = 0
            liege = {
                current_heir = {
                    character = ROOT
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_character_modifier = faction_independence_ultimatum_timer
        }
        
        # Try to exclude people who should rather support a claimant
        modifier = {
            factor = 0
            
            liege = {
                OR = {
                    NOT = { culture = ROOT }
                    NOT = { religion = ROOT }
                }
                any_demesne_title = {
                    OR = {
                        is_primary_holder_title = yes
                        higher_tier_than = DUKE
                    }
                    ROOT = {
                        primary_title = {
                            de_jure_liege_or_above = PREVPREV
                        }
                    }
                    any_claimant = {
                        culture = ROOT
                        religion = ROOT
                    }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            OR = {
                AND = {
                    NOT = { in_faction = faction_independence }
                    opinion = { who = LIEGE value = 50 }
                }
                AND = {
                    in_faction = faction_independence
                    opinion = { who = LIEGE value = 60 }
                }
            }
            
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            liege = { 
                primary_title = { is_tribal_type_title = yes }
                culture = ROOT
                religion = ROOT
            }
        }
        
        modifier = {
            factor = 0
            has_opinion_modifier = {
                who = LIEGE
                modifier = opinion_coerced_into_leaving_faction
            }
        }
        
        modifier = {
            factor = 0
            
            # Won't join this type of faction if our capital borders the liege's capital
            liege = {
                capital_scope = {
                    any_neighbor_province = {
                        ROOT = {
                            capital_scope = {
                                province = PREVPREV
                            }
                        }
                    }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 1000
            has_opinion_modifier = {
                who = FROM
                modifier = opinion_coerced_into_joining_faction
            }
        }
        
        # Clans are very unlikely to join Independence factions led by non-nomads
        modifier = {
            factor = 0.01
            is_nomadic = yes
            FROM = {
                is_nomadic = no
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        # Loyalty (Friends, Alliance, Sociopathy)
        
        modifier = { factor = 2.0 is_disloyal_to_liege_trigger = yes }
        modifier = { factor = 1.5 self_serving_trigger = yes }
        modifier = { factor = 0.2 is_friend_with_liege_trigger = yes }
        modifier = { factor = 0.0 is_good_friend_with_liege_trigger = yes }
        
        # Council
        
        modifier = { factor = 0.7 has_council_position_trigger = yes }
        
        # Religion Culture Pull / Aversion
        
        modifier = { factor = 1.5  religion_faction_pull_trigger = yes }
        modifier = { factor = 1.5  culture_faction_pull_trigger = yes }
        
        modifier = { factor = 0.5  religion_faction_aversion_trigger = yes }
        modifier = { factor = 0.5  culture_faction_aversion_trigger = yes }
        
        # Culture
        
        modifier = { factor = 0.8 is_culture_same = yes }
        modifier = { factor = 1.2 is_different_culture_group = yes }
        
        modifier = { factor = 2.0 is_independent_culture_liege_not_same = yes }
        modifier = { factor = 2.0 is_independent_culture_liege_not_same_group = yes }
        
        # Religion
        
        modifier = { factor = 0.0 is_zealous_liege_zealous_same_religion = yes }
        modifier = { factor = 0.5 is_zealous_same_religion = yes }
        modifier = { factor = 0.9 is_just_same_religion = yes }
        modifier = { factor = 1.2 is_cynical_different_religion = yes }
        modifier = { factor = 2.0 is_just_different_religion = yes }
        modifier = { factor = 3.0 is_zealous_different_religion = yes }
        
        # Opinion - Liege's opinion of Vassal (smaller impact due to limited control)
        
        modifier = { factor = 0.825 liege_opinion_vassal_p99_trigger = yes }
        modifier = { factor = 0.85 liege_opinion_vassal_p85_trigger = yes }
        modifier = { factor = 0.875 liege_opinion_vassal_p70_trigger = yes }
        modifier = { factor = 0.9 liege_opinion_vassal_p55_trigger = yes }
        modifier = { factor = 0.925 liege_opinion_vassal_p40_trigger = yes }
        modifier = { factor = 0.95 liege_opinion_vassal_p25_trigger = yes }
        modifier = { factor = 0.975 liege_opinion_vassal_p5_trigger = yes }
        
        modifier = { factor = 1.025 liege_opinion_vassal_n5_trigger = yes }
        modifier = { factor = 1.05 liege_opinion_vassal_n25_trigger = yes }
        modifier = { factor = 1.075 liege_opinion_vassal_n40_trigger = yes }
        modifier = { factor = 1.1 liege_opinion_vassal_n55_trigger = yes }
        modifier = { factor = 1.125 liege_opinion_vassal_n70_trigger = yes }
        modifier = { factor = 1.15 liege_opinion_vassal_n85_trigger = yes }
        modifier = { factor = 1.20 liege_opinion_vassal_n99_trigger = yes }
        
        # Opinion - Vassal's Opinion of Liege
        
        modifier = { factor = 0.01 vassal_opinion_liege_p99 = yes }
        modifier = { factor = 0.025 vassal_opinion_liege_p85 = yes }
        modifier = { factor = 0.05 vassal_opinion_liege_p70 = yes }
        modifier = { factor = 0.1 vassal_opinion_liege_p55 = yes }
        modifier = { factor = 0.2 vassal_opinion_liege_p40 = yes }
        modifier = { factor = 0.6 vassal_opinion_liege_p25 = yes }
        modifier = { factor = 0.95 vassal_opinion_liege_p5 = yes }
        
        modifier = { factor = 1.05 vassal_opinion_liege_n5 = yes }
        modifier = { factor = 1.2 vassal_opinion_liege_n25 = yes }
        modifier = { factor = 1.3 vassal_opinion_liege_n40 = yes }
        modifier = { factor = 1.4 vassal_opinion_liege_n55 = yes }
        modifier = { factor = 1.6 vassal_opinion_liege_n70 = yes }
        modifier = { factor = 1.8 vassal_opinion_liege_n85 = yes }
        modifier = { factor = 2.0 vassal_opinion_liege_n99 = yes }
        
        # Distance
        
        modifier = { factor = 1.3 liege_is_600_distance = yes }
        modifier = { factor = 1.6 liege_is_800_distance = yes }
        modifier = { factor = 2.0 liege_is_1200_distance = yes }
        modifier = { factor = 2.5 liege_is_1500_distance = yes }
        
        # Traits
        
        modifier = { factor = 0.1 is_dumb_trigger = yes }
        modifier = { factor = 0.5 has_benevolent_trait_trigger = yes }
        modifier = { factor = 0.75 is_trustworthy_trigger = yes }
        modifier = { factor = 0.9 is_smart_trigger = yes }
        modifier = { factor = 1.5 character_is_irrational = yes }
        
        
        modifier = { factor = 0.025 trait = content }
        modifier = { factor = 0.025 trait = craven }
        modifier = { factor = 0.1 trait = inbred }
        modifier = { factor = 1.25 trait = envious }
        modifier = { factor = 1.25 trait = brave }
        modifier = { factor = 1.5 trait = proud }
        modifier = { factor = 1.5 trait = arbitrary }
        modifier = { factor = 1.5 trait = greedy }
        modifier = { factor = 2.0 trait = deceitful }
        
        # Bastard
        
        modifier = { factor = 1.1 liege_is_bastard_kind = yes } # you're kind, but the liege is a bastard
        modifier = { factor = 1.6 liege_is_bastard_unkind = yes }
		
		# Joined FROMFROM when FROMFROM claimed the High Kingdom, should be less likely to want independence
		modifier = {
			factor = 0.3
			has_flag = supported_claim_on_high_kingdom
			FROMFROM = { has_flag = succ_claimed_HK }
		}
    }
    
    success = {
        independent = yes
    }
    
    abort = {
        always = no
    }
    
    abort_effect = {
    }
    
    effect = {
        FROM = {
            any_faction_backer = {
                faction = faction_independence
                reverse_opinion = {
                    modifier = opinion_grateful
                    who = FROM
                    years = 5
                }
            }
        }
    }
}

# Support Claimant to Liege Title
faction_claimant = {
    type = liege_titles_w_claimant # 'new_character' is a Claimant, or, if the title is Elective, anyone eligible for election
    exclusive = yes # Can only lead or be in one faction of this type
    
    warning_level = 0.7 # At this level of faction power we give player an alert. Set to 0 for no alerts.
    
    # Plotter scope
    potential = {
        NOT = {
            in_faction = faction_loyalist
        }
        
        allow_join_faction_trigger = yes
        
        OR = {
            NOT = { has_dlc = "Zeus" }
            is_voter = no
            is_nomadic = yes
            is_tribal = yes
            liege = { 
                OR = {
                    is_council_content = no
                    NOT = { primary_title = { has_law = war_voting_power_1 } }
                    #has_council = no
                }
            }
        }
        liege = {
            is_vice_royalty = no
            OR = {
                is_feudal = yes
                is_tribal = yes
                is_nomadic = yes
            }
            OR = {
                # Hordes should have less problems with this type of faction until ca 1350
                year = 1350
                primary_title = { is_tribal = no }
                NOT = { culture = ROOT }
                NOT = { religion = ROOT }
            }        
            NOT = {
                any_demesne_title = {
                    temporary = yes
                }
            }            
        }
        primary_title = { higher_tier_than = BARON }
        
        OR = {
            # Is not affected by a Crown Law title
            NOT = {
                crownlaw_title = {
                    always = yes
                }
            }
            
            # The Crown Law title holder is my liege
            crownlaw_title = {
                holder_scope = {
                    ROOT = {
                        liege = {
                            character = PREVPREV
                        }
                    }
                }
            }
            
            # The Crown Law title allows vassal infighting
            crownlaw_title = {
                NOT = {
                    OR = {
                        has_law = crown_authority_2
                        has_law = crown_authority_3
                        has_law = crown_authority_4
                    }
                }
            }
        }
        OR = {
            liege = {
                is_nomadic = no
            }
            AND = {
                liege = {
                    is_nomadic = yes
                    NOT = { has_blood_oath_with = PREV }
                }
                is_nomadic = yes
                new_character = {
                    character = PREV
                }
                has_dlc = "Horse Lords"
            }
        }
        
        NOT = { has_character_modifier = faction_claimant_timer }
    }
    
    # Target scope
    allow = {
        OR = {
            is_primary_holder_title = yes
            higher_tier_than = DUKE
        }
        new_character = {
            NOT = { has_landed_title = PREV }
            
            NOT = { is_vassal_or_below = FROM }
            
            OR = {
                same_realm = FROM
                FROM = {
                    liege = { independent = yes }
                }
            }
            
            OR = {
                is_female = no
                NOT = { ROOT = { succ_law_title = { has_law = agnatic_succession } } }
            }
            
            OR = {
                ROOT = { has_law = succ_feudal_elective }
                has_claim = ROOT
            }
            
            OR = {
                is_ruler = no
                primary_title = {
                    OR = {
                        is_primary_type_title = no # Static Mercs, the high_septon, Holy Orders, etc
                        higher_tier_than = ROOT
                        tier = ROOT
                    }
                }
            }
            
            ROOT = {
                holder_scope = {
                    NOT = {
                        defending_against_claimant = {
                            character = PREVPREV
                            title = ROOT
                        }
                    }
                }
            }
        }
        
        NOT = {
            holder_scope = {
                reverse_has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_leaving_faction
                }
            }
        }
    }
    
    # Faction member scope (ROOT = joiner, FROM = target)
    allow_join = {
        ROOT = {
            is_ruler = yes
            independent = no
            is_landed = yes
            is_adult = yes
            NOT = { trait = incapable }
            prisoner = no
            OR = {
                NOT = { has_dlc = "Zeus"}
                is_voter = no
                is_nomadic = yes
                is_tribal = yes
                liege = { 
                    OR = {
                        is_council_content = no
                        NOT = { primary_title = { has_law = war_voting_power_1 } }
                        #has_council = no
                    }
                }
            }
            
            # Can't join factions when in blood oath with liege
            OR = {
                is_nomadic = no
                NOT = { has_dlc = "Horse Lords" }
                liege = {
                    NOT = { has_blood_oath_with = PREV }
                }
            }
        }
    }    
    
    # AI creation weight
    chance = {
        factor = 1
        
        modifier = {
            factor = 0.2
            FROM = { pacifist = yes }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                OR = {
                    prisoner = yes
                    has_character_modifier = in_seclusion
                }
            }
        }
        
        modifier = {
            factor = 0
            holder_scope = {
                any_spouse = { character = FROM }
            }
        }
        
        # Will not install old women
        modifier = {
            factor = 0
            new_character = {
                is_female = yes
                age = 40
            }
        }
        
        # Will not install a parent of the current ruler's
        modifier = {
            factor = 0
            new_character = {
                FROM = {
                    liege = {
                        or = {
                            is_father = PREVPREV
                            is_mother = PREVPREV
                        }
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            NOT = { has_law = succ_feudal_elective }
            current_heir = {
                OR = {
                    character = FROM
                    ROOT = {
                        new_character = {
                            character = PREVPREV
                        }
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            holder_scope = {
                dynasty = FROM
                religion = FROM
                culture = FROM
            }
            new_character = {
                NOT = { dynasty = FROM }
            }
        }
        
        modifier = {
            factor = 0
            new_character = {
                ROOT = {
                    holder_scope = {
                        is_child_of = PREVPREV
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            new_character = {
                OR = { 
                    NOT = { religion = FROM }
                    NOT = { culture_group = FROM }
                    trait = blinded
                    trait = eunuch
                    trait = incapable
                    trait = imbecile
                    trait = inbred
                }
            }
        }
        
        modifier = {
            factor = 0
            has_law = succ_feudal_elective
            new_character = {
                character = FROM
                NOT = { trait = ambitious }
                NOT = { trait = deceitful }
                NOT = { trait = proud }
                NOT = { has_strong_claim = PREV }
            }
        }
        
        modifier = {
            factor = 0
            NOT = { has_law = succ_feudal_elective }
            holder_scope = {
                culture_group = FROM
                religion = FROM
                
                any_war = {
                    war_title = ROOT
                    defender = { character = THIS } 
                    attacker = {
                        OR = {
                            NOT = { culture_group = FROM }
                            NOT = { religion = FROM }
                        }
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            FROM = {
                OR = {
                    AND = {
                        NOT = { leads_faction = faction_claimant }
                        opinion = { who = LIEGE value = 50 } 
                    }
                    AND = {
                        leads_faction = faction_claimant
                        opinion = { who = LIEGE value = 75 } 
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            NOT = { new_character = { character = FROM } }
            FROM = {
                has_claim = ROOT
            }
        }
        
        modifier = {
            factor = 0
            NOT = { de_jure_vassal_or_below = FROM }
            holder_scope = {
                any_demesne_title = {
                    is_primary_holder_title_tier = yes
                    de_jure_vassal_or_below = FROM
                    NOT = { title = ROOT }
                }
            }
        }
        
        modifier = {
            factor = 0
            is_conquered = yes
#            NOT = { conquest_culture = FROM }
            NOT = { new_character = { culture = FROM } }
        }
        
        modifier = {
            factor = 0
            NOT = {
                new_character = {
                    character = FROM
                }
            }
            NOT = {
                new_character = {
                    FROM = {
                        OR = {
                            AND = {
                                NOT = { in_faction = faction_claimant }
                                opinion_diff = {
                                    first = PREV
                                    second = LIEGE
                                    value = 10 # I like the Claimant more than the current ruler
                                    as_if_liege = yes
                                }
                            }
                            AND = {
                                in_faction = faction_claimant
                                opinion_diff = {
                                    first = PREV
                                    second = LIEGE
                                    value = -5
                                    as_if_liege = yes
                                }
                            }
                        }
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            FROM = { preparing_invasion = yes }
        }
        
        modifier = {
            factor = 0.1
            is_conquered = yes
            NOT = { conquest_culture = FROM }
            holder_scope = {
                any_vassal = {
                    NOT = { character = FROM }
                    in_faction = faction_claimant
                    faction_claimant = {
                        new_character = {
                            culture = FROM # If we are subjugated, tend to unite behind one single claimant
                            FROM = {
                                opinion_diff = {
                                    first = PREV
                                    second = LIEGE
                                    value = 10 # I like the Claimant more than the current ruler
                                    as_if_liege = yes
                                }
                            }
                        }
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            FROM = { 
                opinion = { who = LIEGE value = 25 } 
                NOT = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }
            }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                opinion = { who = LIEGE value = 50 } 
                OR = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }            
            }
        }
        
        modifier = {
            factor = 0.2
            NAND = {
                has_dlc = "Zeus"
                OR = {
                    has_law = status_of_women_4
                    has_game_rule = {
                        name = gender
                        value = all
                    }
                }
            }
            new_character = {
                is_female = yes
            }
        }
        
        modifier = {
            factor = 0.5
            new_character = {
                NOT = { age = 13 }
            }
        }
        
        modifier = {
            factor = 0.5
            new_character = {
                NOT = { age = 10 }
            }
        }
        
        modifier = {
            factor = 0.5
            new_character = {
                NOT = { age = 5 }
            }
        }
        
        modifier = {
            factor = 1.5
            NOT = { FROM = { opinion = { who = LIEGE value = 0 } } }
        }
        modifier = {
            factor = 2.0
            NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
        }
        modifier = {
            factor = 4.0
            NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
        }
        
        modifier = {
            factor = 3.0
            new_character = {
                character = FROM
            }
        }
        
        modifier = {
            factor = 1.5
            new_character = {
                dynasty = FROM
            }
        }
        
        modifier = {
            factor = 4.0
            is_conquered = yes
            NOT = { conquest_culture = FROM }
            new_character = { culture = FROM }
        }
        
        modifier = {
            factor = 2.0
            holder_scope = {
                dynasty_realm_power = 0.25
            }
            new_character = {
                ROOT = {
                    holder_scope = { 
                        NOT = { dynasty = PREVPREV }
                    }
                }
            }
        }
        modifier = {
            factor = 2.0
            holder_scope = {
                dynasty_realm_power = 0.4
            }
            new_character = {
                ROOT = {
                    holder_scope = { 
                        NOT = { dynasty = PREVPREV }
                    }
                }
            }
        }
        
        modifier = {
            factor = 0.01
            FROM = { trait = content }
            OR = {
                is_conquered = no
                conquest_culture = FROM
            }
        }
        modifier = {
            factor = 0.01
            FROM = { trait = imbecile }
        }
        modifier = {
            factor = 0.1
            FROM = { trait = inbred }
        }
        modifier = {
            factor = 0.1
            FROM = { trait = craven }
        }
        modifier = {
            factor = 0.2
            FROM = { 
                OR = {
                    trait = slow
                    trait = dull
                }
            }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = brave }
        }
        modifier = {
            factor = 4.0
            FROM = { trait = ambitious }
        }
    }
    
    # AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
    membership = {
        factor = 1
        
        modifier = {
            factor = 0
            
            in_faction = faction_loyalist
        }
        
        modifier = {
            factor = 0.2
            pacifist = yes
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            OR = {
                prisoner = yes
                trait = incapable
                is_adult = no
                is_landed = no
                preparing_invasion = yes
            }
        }
        
        modifier = {
            factor = 0
            FROMFROM = {
                current_heir = {
                    character = ROOT
                }
                new_character = {
                    NOT = { character = ROOT }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            liege = {
                dynasty = ROOT
                religion = ROOT
                culture = ROOT
            }
            FROMFROM = {
                new_character = {
                    NOT = { dynasty = ROOT }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            FROMFROM = {
                new_character = {
                    OR = {
                        NOT = { religion = ROOT }
                        NOT = { culture_group = ROOT }
                        trait = blinded
                        trait = eunuch
                        trait = incapable
                        trait = imbecile
                        trait = inbred
                    }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            liege = {
                culture_group = ROOT
                religion = ROOT
                any_war = {
                    war_title = FROMFROM
                    defender = { character = THIS } 
                    attacker = {
                        OR = {
                            NOT = { culture_group = ROOT }
                            NOT = { religion = ROOT }
                        }
                    }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            FROMFROM = {
                NOT = { de_jure_vassal_or_below = ROOT }
                holder_scope = {
                    any_demesne_title = {
                        is_primary_holder_title_tier = yes
                        de_jure_vassal_or_below = ROOT
                        NOT = { title = PREVPREV }
                    }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            FROMFROM = {
                is_conquered = yes
#                NOT = { conquest_culture = ROOT }
                NOT = { new_character = { culture = ROOT } }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            FROMFROM = {
                claimed_by = ROOT
                NOT = { new_character = { character = ROOT } }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_character_modifier = faction_claimant_timer
        }
        
        modifier = {
            factor = 0
            liege = { 
                NOT = { year = 1350 }
                primary_title = { is_tribal_type_title = yes }
                culture = ROOT
                religion = ROOT
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 50 }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        # If there is an antiking faction, prioritize that
        modifier = {
            factor = 0
            religion = the_seven
            top_liege = {
                ROOT = {
                    liege = {
                        character = PREVPREV
                    }
                }
                religion = ROOT
                rightful_religious_head_scope = {
                    has_claim = k_papal_state
                }
                any_realm_lord = {
                    in_faction = faction_antiking
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            NOT = {
                FROMFROM = {
                    new_character = {
                        character = ROOT
                    }
                }
            }
            
            NOT = {
                FROMFROM = {
                    new_character = {
                        ROOT = {
                            OR = {
                                AND = {
                                    NOT = { in_faction = faction_claimant }
                                    opinion_diff = {
                                        first = PREV
                                        second = LIEGE
                                        value = 10 # I like the Claimant more than the current ruler
                                        as_if_liege = yes
                                    }
                                }
                                AND = {
                                    in_faction = faction_claimant
                                    opinion_diff = {
                                        first = PREV
                                        second = LIEGE
                                        value = -5
                                        as_if_liege = yes
                                    }
                                }
                            }
                        }
                    }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_opinion_modifier = {
                who = LIEGE
                modifier = opinion_coerced_into_leaving_faction
            }
        }
        
        modifier = {
            factor = 1000
            has_opinion_modifier = {
                who = FROM
                modifier = opinion_coerced_into_joining_faction
            }
        }
        
        modifier = {
            factor = 3.0
            FROMFROM = {
                new_character = {
                    character = ROOT
                }
            }
        }
        
        modifier = {
            factor = 1.5
            FROMFROM = {
                new_character = {
                    dynasty = ROOT
                }
            }
        }
        
        modifier = {
            factor = 0.2
            NAND = {
                has_dlc = "Zeus"
                OR = {
                    has_law = status_of_women_4
                    has_game_rule = {
                        name = gender
                        value = all
                    }
                }
            }
            FROMFROM = {
                new_character = {
                    is_female = yes
                    NOT = { character = ROOT }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 25 }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0.5
            FROMFROM = {
                new_character = {
                    NOT = { age = 13 }
                    NOT = { character = ROOT }
                }
            }
        }
        
        modifier = {
            factor = 0.5
            FROMFROM = {
                new_character = {
                    NOT = { age = 10 }
                    NOT = { character = ROOT }
                }
            }
        }
        
        modifier = {
            factor = 0.5
            FROMFROM = {
                new_character = {
                    NOT = { age = 5 }
                    NOT = { character = ROOT }
                }
            }
        }
        
        modifier = {
            factor = 2.0
            FROMFROM = {
                new_character = {
                    ROOT = {
                        opinion_diff = {
                            first = PREV
                            second = LIEGE
                            value = 40
                            as_if_liege = yes
                        }
                    }
                }
            }
        }
        
        modifier = {
            factor = 2.0
            FROMFROM = {
                new_character = {
                    ROOT = {
                        opinion_diff = {
                            first = PREV
                            second = LIEGE
                            value = 60
                            as_if_liege = yes
                        }
                    }
                }
            }
        }
        
        modifier = {
            factor = 0.01
            trait = content
            FROMFROM = {
                OR = {
                    is_conquered = no
                    conquest_culture = ROOT
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 2.0
            liege = {
                dynasty_realm_power = 0.25
            }
            FROMFROM = {
                new_character = {
                    ROOT = {
                        liege = { 
                            NOT = { dynasty = PREVPREV }
                        }
                    }
                }
            }
        }
        
        modifier = {
            factor = 2.0
            liege = {
                dynasty_realm_power = 0.4
            }
            FROMFROM = {
                new_character = {
                    ROOT = {
                        liege = { 
                            NOT = { dynasty = PREVPREV }
                        }
                    }
                }
            }
        }
        
        modifier = {
            factor = 0.01
            trait = imbecile
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            trait = inbred
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            trait = craven
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.2
            OR = {
                trait = slow
                trait = dull
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 1.5
            trait = brave
        }
        modifier = {
            factor = 4.0
            trait = ambitious
        }
    }
    
    success = {
        always = no
    }
    
    abort = {
        always = no        # Factions will abort if the Potential or Allow triggers are no longer valid
    }
    
    abort_effect = {
    }
    
    effect = {
    }
}

# Antiking Faction
faction_antiking = {
    type = liege_titles
    
    warning_level = 0.7 # At this level of faction power we give player an alert. Set to 0 for no alerts.
    
    rel_head_loyalist = yes # Members consider the "real" high_septon to be the rightful religious head
    cancel_on_leader_death = yes # The faction will not automatically continue under a new leader
    
    # Plotter scope
    potential = {
        NOT = {
            in_faction = faction_loyalist
        }
        
        allow_join_faction_trigger = yes
        
        OR = {
            NOT = { has_dlc = "Zeus" }
            is_voter = no
            is_nomadic = yes
            is_tribal = yes
            liege = { 
                OR = {
                    is_council_content = no
                    NOT = { primary_title = { has_law = war_voting_power_1 } }
                    #has_council = no
                }
            }
        }
        religion = the_seven
        primary_title = { higher_tier_than = COUNT }
        liege = {
            religion = ROOT
            government = nomadic_government
            rightful_religious_head_scope = {
                has_claim = k_papal_state
            }
            NOT = {
                any_demesne_title = {
                    temporary = yes
                }
            }            
        }
        
        NOT = { has_character_modifier = faction_antiking_ultimatum_timer }
    }
    
    # Target scope
    allow = {
        higher_tier_than = DUKE
        is_primary_holder_title = yes

        holder_scope = {
            independent = yes
            NOT = {
                any_war = {
                    war_title = ROOT
                    using_cb = cb_install_antiking
                }
            }
            
            NOT = {
                reverse_has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_leaving_faction
                }
            }
        }
        
        OR = {
            culture = FROM
            holder_scope = {
                culture = FROM
            }
        }
    }
    
    # If false, shows the faction entry for players, but disabled
    player_allow = {
        FROM = {
            piety = 500
        }
    }
    
    # Faction member scope (ROOT = joiner, FROM = target)
    allow_join = {
        ROOT = {
            is_ruler = yes
            independent = no
            is_landed = yes
            is_adult = yes
            NOT = { trait = incapable }
            prisoner = no
            OR = {
                NOT = { has_dlc = "Zeus"}
                is_voter = no
                is_nomadic = yes
                is_tribal = yes
                liege = { 
                    OR = {
                        is_council_content = no
                        NOT = { primary_title = { has_law = war_voting_power_1 } }
                        #has_council = no
                    }
                }
            }
        }
    }    
    
    # AI creation weight
    chance = {
        factor = 1
        
        modifier = {
            factor = 0.2
            FROM = { pacifist = yes }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                OR = {
                    prisoner = yes
                    has_character_modifier = in_seclusion
                }
            }
        }
        
        modifier = {
            factor = 0
            holder_scope = {
                any_spouse = { character = FROM }
            }
        }
        
        modifier = {
            factor = 0
            current_heir = {
                character = FROM
            }
        }
        
        modifier = {
            factor = 0
            FROM = { 
                opinion = { who = LIEGE value = 25 } 
                NOT = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }
            }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                opinion = { who = LIEGE value = 50 } 
                OR = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }            
            }
        }
        
        modifier = {
            factor = 1.5
            NOT = { FROM = { opinion = { who = LIEGE value = -10 } } }
        }
        modifier = {
            factor = 2.0
            NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
        }
        modifier = {
            factor = 4.0
            NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
        }
        
        modifier = {
            factor = 0.25
            NOT = { claimed_by = FROM }
        }
        
        modifier = {
            factor = 0.01
            FROM = { trait = content }
        }
        modifier = {
            factor = 0.01
            FROM = { trait = imbecile }
        }
        modifier = {
            factor = 0.1
            FROM = { trait = inbred }
        }
        modifier = {
            factor = 0.1
            FROM = { trait = craven }
        }
        modifier = {
            factor = 0.2
            FROM = { 
                OR = {
                    trait = slow
                    trait = dull
                }
            }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = kind }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = charitable }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = honest }
        }
        modifier = {
            factor = 0.75
            FROM = { trait = humble }
        }
        modifier = {
            factor = 0.75
            FROM = { trait = just }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = proud }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = brave }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = arbitrary }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = envious }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = greedy }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = impaler }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = deceitful }
        }
        modifier = {
            factor = 4.0
            FROM = { trait = ambitious }
        }
    }
    
    # AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
    membership = {
        factor = 1        
        
        modifier = {
            factor = 0
            
            in_faction = faction_loyalist
        }
        
        modifier = {
            factor = 0
            OR = {
                prisoner = yes
                trait = incapable
                is_adult = no
                is_landed = no
                preparing_invasion = yes
                NOT = { religion = FROM }
            }
        }
        
        modifier = {
            factor = 0
            FROMFROM = {
                current_heir = {
                    character = ROOT
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_character_modifier = faction_antiking_ultimatum_timer
        }
        
        modifier = {
            factor = 0
            NOT = { opinion = { who = FROM value = -40 } }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_opinion_modifier = {
                who = LIEGE
                modifier = opinion_coerced_into_leaving_faction
            }
        }
        
        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 25 }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 1000
            has_opinion_modifier = {
                who = FROM
                modifier = opinion_coerced_into_joining_faction
            }
        }
        
        modifier = {
            factor = 0.2
            pacifist = yes
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }    
        
        modifier = {
            factor = 1.5
            NOT = { opinion = { who = LIEGE value = -10 } }
        }
        modifier = {
            factor = 2.0
            NOT = { opinion = { who = LIEGE value = -50 } }
        }
        modifier = {
            factor = 4.0
            NOT = { opinion = { who = LIEGE value = -75 } }
        }
        
        modifier = {
            factor = 0.01
            trait = content
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.01
            trait = imbecile
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            trait = inbred
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            trait = craven
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.2
            OR = {
                trait = slow
                trait = dull
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.5
            trait = kind
        }
        modifier = {
            factor = 0.5
            trait = charitable
        }
        modifier = {
            factor = 0.5
            trait = honest
        }
        modifier = {
            factor = 0.75
            trait = humble
        }
        modifier = {
            factor = 0.75
            trait = just
        }
        modifier = {
            factor = 1.5
            trait = proud
        }
        modifier = {
            factor = 1.5
            trait = brave
        }
        modifier = {
            factor = 1.5
            trait = arbitrary
        }
        modifier = {
            factor = 2.0
            trait = envious
        }
        modifier = {
            factor = 2.0
            trait = greedy
        }
        modifier = {
            factor = 2.0
            trait = impaler
        }
        modifier = {
            factor = 2.0
            trait = deceitful
        }
        modifier = {
            factor = 4.0
            trait = ambitious
        }
    }
    
    success = {
        always = no
    }
    
    abort = {
        always = no
    }
    
    abort_effect = {
    }
    
    effect = {
    }
}

# Overthrow a weak Khan faction
faction_overthrow = {

    type = liege_titles
    
    warning_level = 0.7 # At this level of faction power we give player an alert. Set to 0 for no alerts.
    
    cancel_on_leader_death = yes # The faction will not automatically continue under a new leader
    
    # Plotter scope
    potential = {
        NOT = {
            in_faction = faction_loyalist
        }
        
        allow_join_faction_trigger = yes
        
        is_nomadic = yes
        OR = {
            NOT = { has_dlc = "Zeus" }
            is_voter = no
            is_nomadic = yes
            is_tribal = yes
            liege = { 
                OR = {
                    is_council_content = no
                    NOT = { primary_title = { has_law = war_voting_power_1 } }
                    #has_council = no
                }
            }
        }
        liege = {
            NOT = { has_blood_oath_with = PREV }
        }
    }
    
    # Target scope
    allow = {
        is_nomadic = yes
        is_primary_holder_title = yes

        holder_scope = {
            independent = yes
            
            NOT = {
                OR = {
                    reverse_has_opinion_modifier = {
                        who = FROM
                        modifier = opinion_coerced_into_leaving_faction
                    }
                    blood_brother = {
                        holder_scope = {
                            character = FROM
                        }
                    }
                }
            }
        }
    }
    
    # If false, shows the faction entry for players, but disabled
    player_allow = {
        is_nomadic = yes
    }
    
    # Faction member scope (ROOT = joiner, FROM = target)
    allow_join = {
        ROOT = {
            is_ruler = yes
            independent = no
            is_landed = yes
            is_adult = yes
            is_nomadic = yes
            NOT = { trait = incapable }
            prisoner = no
            OR = {
                NOT = { has_dlc = "Zeus"}
                is_voter = no
                is_nomadic = yes
                is_tribal = yes
                liege = { 
                    OR = {
                        is_council_content = no
                        NOT = { primary_title = { has_law = war_voting_power_1 } }
                        #has_council = no
                    }
                }
            }
            #NOT = {
            #    blood_brother = {
            #        holder_scope = {
            #            character = FROM
            #        }
            #    }
            #}
            # Can't join factions when in blood oath with liege
            OR = {
                is_nomadic = no
                NOT = { has_dlc = "Horse Lords" }
                liege = {
                    NOT = { has_blood_oath_with = PREV }
                }
            }
        }
    }    
    
    # AI creation weight
    chance = {
        factor = 1
        
        modifier = {
            factor = 0.2
            FROM = { pacifist = yes }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                OR = {
                    prisoner = yes
                    has_character_modifier = in_seclusion
                }
            }
        }
        
        modifier = {
            factor = 0
            holder_scope = {
                any_spouse = { character = FROM }
            }
        }
        
        modifier = {
            factor = 0
            current_heir = {
                character = FROM
            }
        }
        
        modifier = {
            factor = 0
            FROM = { 
                opinion = { who = LIEGE value = 50 } 
                NOT = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }
                liege = {
                    NOT = { is_weak_trigger = yes }
                    health = 4
                }
            }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                opinion = { who = LIEGE value = 75 } 
                OR = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }
                liege = {
                    NOT = { is_weak_trigger = yes }
                    health = 4
                }        
            }
        }
        
        modifier = {
            factor = 1.5
            NOT = { 
                holder_scope = {
                    clan_title = {
                        FROM = { 
                            clan_title = {
                                clan_opinion = { who = PREVPREV value = -10 }
                            }
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 2.0
            NOT = { 
                holder_scope = {
                    clan_title = {
                        FROM = { 
                            clan_title = {
                                clan_opinion = { who = PREVPREV value = -50 }
                            }
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 4.0
            NOT = { 
                holder_scope = {
                    clan_title = {
                        FROM = { 
                            clan_title = {
                                clan_opinion = { who = PREVPREV value = -75 }
                            }
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 0.25
            holder_scope = { 
                clan_title = {
                    FROM = { 
                        clan_title = {
                            clan_opinion = { who = PREVPREV value = 10 }
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 0.05
            holder_scope = { 
                clan_title = {
                    FROM = { 
                        clan_title = {
                            clan_opinion = { who = PREVPREV value = 50 }
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 0.01
            holder_scope = { 
                clan_title = {
                    FROM = { 
                        clan_title = {
                            clan_opinion = { who = PREVPREV value = 75 }
                        }
                    }
                }
            }
        }

        modifier = {
            factor = 1.5
            NOT = { FROM = { opinion = { who = LIEGE value = -10 } } }
        }
        modifier = {
            factor = 2.0
            NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
        }
        modifier = {
            factor = 4.0
            NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
        }

        modifier = {
            factor = 0.25
            FROM = { opinion = { who = LIEGE value = 10 } }
        }
        modifier = {
            factor = 0.05
            FROM = { opinion = { who = LIEGE value = 50 } }
        }
        modifier = {
            factor = 0.01
            FROM = { opinion = { who = LIEGE value = 75 } }
        }

        modifier = {
            factor = 1.5
            FROM = {
                liege = {
                    trait = content
                }
            }
        }

        modifier = {
            factor = 1.5
            FROM = {
                liege = {
                    trait = imbecile
                }
            }
        }

        modifier = {
            factor = 1.5
            FROM = {
                liege = {
                    trait = inbred
                }
            }
        }

        modifier = {
            factor = 1.5
            FROM = {
                liege = {
                    OR = {
                        trait = slow
                        trait = dull
                    }
                }
            }
        }

        modifier = {
            factor = 1.5
            FROM = {
                liege = {
                    trait = kind
                }
            }
        }

        modifier = {
            factor = 1.5
            FROM = {
                liege = {
                    trait = humble
                }
            }
        }

        modifier = {
            factor = 2
            FROM = {
                liege = {
                    trait = craven
                }
            }
        }

        modifier = {
            factor = 3
            FROM = {
                liege = {
                    is_weak_trigger = yes
                }
            }
        }

        modifier = {
            factor = 0.01
            FROM = {
                liege = {
                    OR = {
                        trait = strong
                        trait = robust
                    }
                }
            }
        }

        modifier = {
            factor = 1.5
            FROM = {
                liege = {
                    NOT = { health = 5 }
                }
            }
        }

        modifier = {
            factor = 2
            FROM = {
                liege = {
                    NOT = { health = 3 }
                }
            }
        }
        
        modifier = {
            factor = 0.01
            FROM = { trait = content }
        }
        modifier = {
            factor = 0.01
            FROM = { trait = imbecile }
        }
        modifier = {
            factor = 0.1
            FROM = { trait = inbred }
        }
        modifier = {
            factor = 0.1
            FROM = { trait = craven }
        }
        modifier = {
            factor = 0.2
            FROM = { 
                OR = {
                    trait = slow
                    trait = dull
                }
            }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = kind }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = charitable }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = honest }
        }
        modifier = {
            factor = 0.75
            FROM = { trait = humble }
        }
        modifier = {
            factor = 0.75
            FROM = { trait = just }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = proud }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = brave }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = arbitrary }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = envious }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = greedy }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = impaler }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = deceitful }
        }
        modifier = {
            factor = 4.0
            FROM = { trait = ambitious }
        }
    }
    
    # AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
    membership = {
        factor = 1
        
        modifier = {
            factor = 0
            
            in_faction = faction_loyalist
        }
        
        modifier = {
            factor = 0
            OR = {
                prisoner = yes
                trait = incapable
                is_adult = no
                is_landed = no
                preparing_invasion = yes
            }
        }
        
        modifier = {
            factor = 0
            FROMFROM = {
                current_heir = {
                    character = ROOT
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            NOT = { opinion = { who = FROM value = -40 } }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_opinion_modifier = {
                who = LIEGE
                modifier = opinion_coerced_into_leaving_faction
            }
        }
        
        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 50 }
            liege = {
                NOT = { is_weak_trigger = yes }
                health = 4
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0.2
            pacifist = yes
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }    

        modifier = {
            factor = 1.5
            FROM = {
                liege = {
                    trait = content
                }
            }
        }

        modifier = {
            factor = 1.5
            FROM = {
                liege = {
                    trait = imbecile
                }
            }
        }

        modifier = {
            factor = 1.5
            FROM = {
                liege = {
                    trait = inbred
                }
            }
        }

        modifier = {
            factor = 1.5
            FROM = {
                liege = {
                    OR = {
                        trait = slow
                        trait = dull
                    }
                }
            }
        }

        modifier = {
            factor = 1.5
            FROM = {
                liege = {
                    trait = kind
                }
            }
        }

        modifier = {
            factor = 1.5
            FROM = {
                liege = {
                    trait = humble
                }
            }
        }

        modifier = {
            factor = 2
            FROM = {
                liege = {
                    trait = craven
                }
            }
        }

        modifier = {
            factor = 3
            FROM = {
                liege = {
                    is_weak_trigger = yes
                }
            }
        }

        modifier = {
            factor = 0.01
            FROM = {
                liege = {
                    OR = {
                        trait = strong
                        trait = robust
                    }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }

        modifier = {
            factor = 1.5
            FROM = {
                liege = {
                    NOT = { health = 5 }
                }
            }
        }

        modifier = {
            factor = 2
            FROM = {
                liege = {
                    NOT = { health = 3 }
                }
            }
        }

        modifier = {
            factor = 1.5
            NOT = { 
                liege = { 
                    clan_title = {
                        ROOT = { 
                            clan_title = {
                                clan_opinion = { who = PREVPREV value = -10 }
                            }
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 2.0
            NOT = { 
                liege = { 
                    clan_title = {
                        ROOT = { 
                            clan_title = {
                                clan_opinion = { who = PREVPREV value = -50 }
                            }
                        }
                    }
                }
            }
        }
        modifier = {
            factor = 4.0
            NOT = { 
                liege = { 
                    clan_title = {
                        ROOT = { 
                            clan_title = {
                                clan_opinion = { who = PREVPREV value = -75 }
                            }
                        }
                    }
                }
            }
        }

        modifier = {
            factor = 0.5
            liege = { 
                clan_title = {
                    ROOT = { 
                        clan_title = {
                            clan_opinion = { who = PREVPREV value = 10 }
                        }
                    }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            liege = { 
                clan_title = {
                    ROOT = { 
                        clan_title = {
                            clan_opinion = { who = PREVPREV value = 50 }
                        }
                    }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.05
            liege = { 
                clan_title = {
                    ROOT = { 
                        clan_title = {
                            clan_opinion = { who = PREVPREV value = 75 }
                        }
                    }
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 1000
            has_opinion_modifier = {
                who = FROM
                modifier = opinion_coerced_into_joining_faction
            }
        }
        
        modifier = {
            factor = 1.5
            NOT = { opinion = { who = LIEGE value = -10 } }
        }
        modifier = {
            factor = 2.0
            NOT = { opinion = { who = LIEGE value = -50 } }
        }
        modifier = {
            factor = 4.0
            NOT = { opinion = { who = LIEGE value = -75 } }
        }
        modifier = {
            factor = 0.25
            opinion = { who = LIEGE value = 10 }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.05
            opinion = { who = LIEGE value = 50 }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.01
            opinion = { who = LIEGE value = 75 }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0.01
            trait = content
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.01
            trait = imbecile
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            trait = inbred
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            trait = craven
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.2
            OR = {
                trait = slow
                trait = dull
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.5
            trait = kind
        }
        modifier = {
            factor = 0.5
            trait = charitable
        }
        modifier = {
            factor = 0.5
            trait = honest
        }
        modifier = {
            factor = 0.75
            trait = humble
        }
        modifier = {
            factor = 0.75
            trait = just
        }
        modifier = {
            factor = 1.5
            trait = proud
        }
        modifier = {
            factor = 1.5
            trait = brave
        }
        modifier = {
            factor = 1.5
            trait = arbitrary
        }
        modifier = {
            factor = 2.0
            trait = envious
        }
        modifier = {
            factor = 2.0
            trait = greedy
        }
        modifier = {
            factor = 2.0
            trait = impaler
        }
        modifier = {
            factor = 2.0
            trait = deceitful
        }
        modifier = {
            factor = 4.0
            trait = ambitious
        }
    }
    
    success = {
        always = no
    }
    
    abort = {
        always = no
    }
    
    abort_effect = {
    }
    
    effect = {
    }
}

# Increase Council Power
faction_increase_council_power = {
    type = liege_titles
    
    warning_level = 0.7 # At this level of faction power we give player an alert. Set to 0 for no alerts.
    
    # Plotter scope
    potential = {
        NOT = {
            in_faction = faction_loyalist
        }
        
        has_dlc = "Zeus"
        
        allow_join_faction_trigger = yes
        
        OR = {
            is_voter = no
            is_nomadic = yes
            is_tribal = yes
            liege = { 
                OR = {
                    is_council_content = no
                    NOT = { primary_title = { has_law = war_voting_power_1 } }
                    has_council = no
                }
            }
        }
        liege = { 
            NOT = {
                is_nomadic = yes
            }
            OR = {
                primary_title = { is_tribal_type_title = no }
                NOT = { culture = ROOT }
                NOT = { religion = ROOT }
            }
            NOT = {
                any_demesne_title = {
                    temporary = yes
                }
            }            
        }
        primary_title = { higher_tier_than = BARON }
        
        NOT = { has_character_modifier = faction_council_power_ultimatum_timer }
    }
    
    # Target scope
    allow = {
        higher_tier_than = COUNT
        is_primary_holder_title = yes
        holder_scope = {
            primary_title = {
                ROOT = {
                    tier = PREV
                }
            }

            NOT = {
                any_vassal = {
                    higher_tier_than = BARON
                    NOT = {    character = FROM }
                    num_of_faction_backers = {
                        faction = faction_increase_council_power
                        value = 0
                    }
                }
            }
        }
        
        holder_scope = {
            primary_title = {
                OR = {
                    has_law = law_voting_power_0
                    has_law = banish_voting_power_0
                    has_law = execution_voting_power_0
                    has_law = revoke_title_voting_power_0
                    has_law = grant_title_voting_power_0
                    has_law = imprison_voting_power_0
                    has_law = war_voting_power_0
                }
            }
            NOT = {
                any_war = {
                    war_title = ROOT
                    using_cb = increase_council_power_war
                }
            }
            
            NOT = {
                reverse_has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_leaving_faction
                }
            }
        }
    }
    
    # Faction member scope (ROOT = joiner, FROM = target)
    allow_join = {
        ROOT = {
            is_ruler = yes
            independent = no
            is_landed = yes
            is_adult = yes
            NOT = { trait = incapable }
            prisoner = no
            NOT = { has_character_modifier = faction_council_power_ultimatum_timer }
            OR = {
                is_voter = no
                is_nomadic = yes
                is_tribal = yes
                liege = { 
                    OR = {
                        is_council_content = no
                        NOT = { primary_title = { has_law = war_voting_power_1 } }
                        #has_council = no
                    }
                }
            }
        }
    }        
    
    # AI creation weight
    chance = {
        factor = 1
        
        modifier = {
            factor = 0.2
            FROM = { pacifist = yes }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                OR = {
                    prisoner = yes
                    has_character_modifier = in_seclusion
                }
            }
        }
        
        modifier = {
            factor = 0
            holder_scope = {
                any_spouse = { character = FROM }
            }
        }
        
        modifier = {
            factor = 0
            current_heir = {
                character = FROM
            }
        }
        
        # Try to exclude people who should rather support a claimant
        modifier = {
            factor = 0
            holder_scope = {
                OR = {
                    NOT = { culture = FROM }
                    NOT = { religion = FROM }
                }
                any_demesne_title = {
                    OR = {
                        is_primary_holder_title = yes
                        higher_tier_than = DUKE
                    }
                    FROM = {
                        primary_title = {
                            de_jure_liege_or_above = PREVPREV
                        }
                    }
                    any_claimant = {
                        culture = FROM
                        religion = FROM
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            FROM = { preparing_invasion = yes }
        }
        
        modifier = {
            factor = 0
            FROM = { 
                opinion = { who = LIEGE value = 40 } 
                NOR = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }
                is_voter = no
            }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                opinion = { who = LIEGE value = 80 }             
            }
        }
        
        modifier = {
            factor = 2
            FROM = { is_voter = yes }
        }

        modifier = {
            factor = 2.5
            FROM = {
                is_voter = yes
                has_position = malcontent
            }
        }

        modifier = {
            factor = 1.5
            FROM = {
                is_voter = yes
                NOT = { has_position = loyalist }
            }
        }
        
        modifier = {
            factor = 0.5
            FROM = { opinion = { who = LIEGE value = 25 } }
        }
        
        modifier = {
            factor = 1.5
            NOT = { FROM = { opinion = { who = LIEGE value = -10 } } }
        }
        modifier = {
            factor = 2.0
            NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
        }
        modifier = {
            factor = 4.0
            NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
        }
        
        modifier = {
            factor = 0.01
            FROM = { trait = content }
        }
        modifier = {
            factor = 0.01
            FROM = { trait = imbecile }
        }
        modifier = {
            factor = 0.1
            FROM = { trait = inbred }
        }
        modifier = {
            factor = 0.1
            FROM = { trait = craven }
        }
        modifier = {
            factor = 0.2
            FROM = { 
                OR = {
                    trait = slow
                    trait = dull
                }
            }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = kind }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = charitable }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = honest }
        }
        modifier = {
            factor = 0.75
            FROM = { trait = humble }
        }
        modifier = {
            factor = 0.75
            FROM = { trait = just }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = proud }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = brave }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = arbitrary }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = envious }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = greedy }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = impaler }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = deceitful }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = ambitious }
        }
    }
    
    # AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
    membership = {
        factor = 1        

        modifier = {
            factor = 0
            
            in_faction = faction_loyalist
        }        
        
        modifier = {
            factor = 0
            OR = {
                prisoner = yes
                trait = incapable
                is_adult = no
                is_landed = no
                preparing_invasion = yes
            }
        }
        
        modifier = {
            factor = 0
            FROMFROM = {
                current_heir = {
                    character = ROOT
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_character_modifier = faction_council_power_ultimatum_timer
        }
        
        modifier = {
            factor = 0
            NOT = { opinion = { who = FROM value = -40 } }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            liege = { 
                NOT = { year = 1350 }
                primary_title = { is_tribal_type_title = yes }
                culture = ROOT
                religion = ROOT
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_opinion_modifier = {
                who = LIEGE
                modifier = opinion_coerced_into_leaving_faction
            }
        }
        
        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 40 }
            is_voter = no
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }

        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 80 }
            is_voter = yes
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0.2
            pacifist = yes
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 2
            is_voter = yes
        }

        modifier = {
            factor = 2.5
            FROM = {
                is_voter = yes
                has_position = malcontent
            }
        }

        modifier = {
            factor = 1.5
            FROM = {
                is_voter = yes
                NOT = { has_position = loyalist }
            }
        }
        
        modifier = {
            factor = 1000
            has_opinion_modifier = {
                who = FROM
                modifier = opinion_coerced_into_joining_faction
            }
        }
        
        modifier = {
            factor = 0.5
            FROM = { opinion = { who = LIEGE value = 25 } }
        }
        
        modifier = {
            factor = 1.5
            NOT = { opinion = { who = LIEGE value = -10 } }
        }
        modifier = {
            factor = 2.0
            NOT = { opinion = { who = LIEGE value = -50 } }
        }
        modifier = {
            factor = 4.0
            NOT = { opinion = { who = LIEGE value = -75 } }
        }
        
        modifier = {
            factor = 0.01
            trait = content
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.01
            trait = imbecile
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            trait = inbred
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            trait = craven
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.2
            OR = {
                trait = slow
                trait = dull
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.5
            trait = kind
        }
        modifier = {
            factor = 0.5
            trait = charitable
        }
        modifier = {
            factor = 0.5
            trait = honest
        }
        modifier = {
            factor = 0.75
            trait = humble
        }
        modifier = {
            factor = 0.75
            trait = just
        }
        modifier = {
            factor = 1.5
            trait = proud
        }
        modifier = {
            factor = 1.5
            trait = brave
        }
        modifier = {
            factor = 1.5
            trait = arbitrary
        }
        modifier = {
            factor = 2.0
            trait = envious
        }
        modifier = {
            factor = 2.0
            trait = greedy
        }
        modifier = {
            factor = 2.0
            trait = impaler
        }
        modifier = {
            factor = 2.0
            trait = deceitful
        }
        modifier = {
            factor = 2.0
            trait = ambitious
        }
    }
    
    success = {
        holder_scope = {
            FROM = {
                has_opinion_modifier = { who = PREV modifier = opinion_increased_council_power }
            }
        }
    }
    
    abort = {
    }
    
    abort_effect = {
    }
    
    effect = {
        FROM = {
            any_faction_backer = {
                faction = faction_increase_council_power
                reverse_opinion = {
                    modifier = opinion_grateful
                    who = FROM
                    years = 5
                }
            }
        }
    }
}

# Powerful vassals overthrow their liege
faction_powerful_vassal_takeover = {
    type = liege_titles
    
    warning_level = 0.7 # At this level of faction power we give player an alert. Set to 0 for no alerts.
    
    # Plotter scope
    potential = {
        NOT = {
            in_faction = faction_loyalist
        }
        
        has_dlc = "Zeus"
        
        allow_join_faction_trigger = yes
        
        OR = {
            is_voter = no
            liege = {
                OR = {
                    is_council_content = no
                    NOT = { primary_title = { has_law = war_voting_power_1 } }
                    has_council = no
                }
            }
        }
        liege = {
            is_feudal = yes
            NOT = { controls_religion = yes }
            NOT = {
                any_demesne_title = {
                    temporary = yes
                }
            }
        }
        primary_title = { higher_tier_than = BARON }
        
        NOT = { has_character_modifier = faction_powerful_vassal_takeover_ultimatum_timer }
    }
    
    # Target scope
    allow = {
        higher_tier_than = DUKE
        is_primary_holder_title = yes
        holder_scope = {
            primary_title = {
                ROOT = {
                    tier = PREV
                }
            }

            NOT = {
                any_vassal = {
                    higher_tier_than = COUNT
                    NOT = {    character = FROM }
                    num_of_faction_backers = {
                        faction = faction_powerful_vassal_takeover
                        value = 0
                    }
                }
            }
        }
        
        holder_scope = {
            NOT = {
                any_war = {
                    war_title = ROOT
                    using_cb = powerful_vassal_takeover_war
                }
            }
            
            NOR = {
                reverse_has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_leaving_faction
                }
                reverse_has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_replaced_bad_ruler
                }
            }
        }
    }
    
    # Faction member scope (ROOT = joiner, FROM = target)
    allow_join = {
        ROOT = {
            is_ruler = yes
            independent = no
            is_landed = yes
            is_adult = yes
            NOT = { trait = incapable }
            prisoner = no
            NOT = { has_character_modifier = faction_powerful_vassal_takeover_ultimatum_timer }
            OR = {
                is_voter = no
                liege = { 
                    OR = {
                        is_council_content = no
                        NOT = { primary_title = { has_law = war_voting_power_1 } }
                        #has_council = no
                    }
                }
            }
        }
    }        
    
    # AI creation weight
    chance = {
        factor = 1
        
        modifier = {
            factor = 0.2
            FROM = { pacifist = yes }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                OR = {
                    prisoner = yes
                    has_character_modifier = in_seclusion
                }
            }
        }
        
        modifier = {
            factor = 0
            holder_scope = {
                any_spouse = { character = FROM }
            }
        }
        
        modifier = {
            factor = 0
            current_heir = {
                character = FROM
            }
        }
        
        # Try to exclude people who should rather support a claimant
        modifier = {
            factor = 0
            holder_scope = {
                OR = {
                    NOT = { culture = FROM }
                    NOT = { religion = FROM }
                }
                any_demesne_title = {
                    OR = {
                        is_primary_holder_title = yes
                        higher_tier_than = DUKE
                    }
                    FROM = {
                        primary_title = {
                            de_jure_liege_or_above = PREVPREV
                        }
                    }
                    any_claimant = {
                        culture = FROM
                        religion = FROM
                    }
                }
            }
        }
        
        modifier = {
            factor = 0
            FROM = { preparing_invasion = yes }
        }
        
        modifier = {
            factor = 0
            FROM = { 
                opinion = { who = LIEGE value = 0 } 
                NOR = {
                    trait = deceitful
                    trait = ambitious
                    trait = envious
                }
                is_voter = no
            }
        }        
        
        modifier = {
            factor = 0
            FROM = {
                opinion = { who = LIEGE value = -15 }             
            }
        }
        
        modifier = {
            factor = 1.5
            NOT = { FROM = { opinion = { who = LIEGE value = -25 } } }
        }
        modifier = {
            factor = 2.0
            NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
        }
        modifier = {
            factor = 4.0
            NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
        }
        modifier = {
            factor = 0.75
            FROM = {
                NOR = {
                    has_opinion_modifier = { who = LIEGE modifier = opinion_evil_tyrant }
                    has_opinion_modifier = { who = LIEGE modifier = opinion_tyrant }
                }
            }
        }
        modifier = {
            factor = 0.01
            FROM = { trait = content }
        }
        modifier = {
            factor = 0.01
            FROM = { trait = imbecile }
        }
        modifier = {
            factor = 0.1
            FROM = { trait = inbred }
        }
        modifier = {
            factor = 0.1
            FROM = { trait = craven }
        }
        modifier = {
            factor = 0.2
            FROM = { 
                OR = {
                    trait = slow
                    trait = dull
                }
            }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = kind }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = charitable }
        }
        modifier = {
            factor = 0.5
            FROM = { trait = honest }
        }
        modifier = {
            factor = 0.75
            FROM = { trait = humble }
        }
        modifier = {
            factor = 0.75
            FROM = { trait = just }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = proud }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = brave }
        }
        modifier = {
            factor = 1.5
            FROM = { trait = arbitrary }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = envious }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = greedy }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = impaler }
        }
        modifier = {
            factor = 2.0
            FROM = { trait = deceitful }
        }
        modifier = {
            factor = 4.0
            FROM = { trait = ambitious }
        }
    }
    
    # AI membership weight: ROOT is the prospective member. FROM is the faction leader. FROMFROM is the target title or character.
    membership = {
        factor = 1        

        modifier = {
            factor = 0
            
            in_faction = faction_loyalist
        }
        
        modifier = {
            factor = 0
            OR = {
                prisoner = yes
                trait = incapable
                is_adult = no
                is_landed = no
                preparing_invasion = yes
            }
        }
        
        modifier = {
            factor = 0
            FROMFROM = {
                current_heir = {
                    character = ROOT
                }
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_character_modifier = faction_powerful_vassal_takeover_ultimatum_timer
        }

        modifier = {
            factor = 0
            opinion = { who = FROMFROM value = 0 }
        }
        
        modifier = {
            factor = 0
            NOT = { opinion = { who = FROM value = -40 } }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            liege = { 
                NOT = { year = 1350 }
                primary_title = { is_tribal_type_title = yes }
                culture = ROOT
                religion = ROOT
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0
            has_opinion_modifier = {
                who = LIEGE
                modifier = opinion_coerced_into_leaving_faction
            }
        }
        
        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 40 }
            is_voter = no
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }

        modifier = {
            factor = 0
            opinion = { who = LIEGE value = 80 }
            is_voter = yes
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        modifier = {
            factor = 0.2
            pacifist = yes
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        
        
        modifier = {
            factor = 1000
            has_opinion_modifier = {
                who = FROM
                modifier = opinion_coerced_into_joining_faction
            }
        }
        
        modifier = {
            factor = 1.5
            NOT = { opinion = { who = LIEGE value = -10 } }
        }
        modifier = {
            factor = 2.0
            NOT = { opinion = { who = LIEGE value = -50 } }
        }
        modifier = {
            factor = 4.0
            NOT = { opinion = { who = LIEGE value = -75 } }
        }
        
        modifier = {
            factor = 0.75
            NOR = {
                has_opinion_modifier = { who = LIEGE modifier = opinion_evil_tyrant }
                has_opinion_modifier = { who = LIEGE modifier = opinion_tyrant }
            }
        }
        
        modifier = {
            factor = 0.01
            trait = content
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.01
            trait = imbecile
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            trait = inbred
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.1
            trait = craven
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.2
            OR = {
                trait = slow
                trait = dull
            }
            NOT = {    
                has_opinion_modifier = {
                    who = FROM
                    modifier = opinion_coerced_into_joining_faction
                }
            }
        }
        modifier = {
            factor = 0.5
            trait = kind
        }
        modifier = {
            factor = 0.5
            trait = charitable
        }
        modifier = {
            factor = 0.5
            trait = honest
        }
        modifier = {
            factor = 0.75
            trait = humble
        }
        modifier = {
            factor = 0.75
            trait = just
        }
        modifier = {
            factor = 1.5
            trait = proud
        }
        modifier = {
            factor = 1.5
            trait = brave
        }
        modifier = {
            factor = 1.5
            trait = arbitrary
        }
        modifier = {
            factor = 2.0
            trait = envious
        }
        modifier = {
            factor = 2.0
            trait = greedy
        }
        modifier = {
            factor = 2.0
            trait = impaler
        }
        modifier = {
            factor = 2.0
            trait = deceitful
        }
        modifier = {
            factor = 4.0
            trait = ambitious
        }
    }
    
    success = {
        holder_scope = {
            FROM = {
                has_opinion_modifier = { who = PREV modifier = opinion_abdicated }
            }
        }
    }
    
    abort = {
    }
    
    abort_effect = {
    }
    
    effect = {
        FROM = {
            any_faction_backer = {
                faction = faction_powerful_vassal_takeover
                reverse_opinion = {
                    modifier = opinion_grateful
                    who = FROM
                    years = 5
                }
            }
        }
    }
}
